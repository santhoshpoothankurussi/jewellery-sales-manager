angular.module("commonfunction",["ng"]).factory("appvariables",function(){return{appvars:{company:null,basepuritypercentage:null,wholesalerate:null,retailrate:null,rateupdateddatetime:null,username:null,loggedinuser:null,displaystore:null,godownstore:null,storeitem:null,searchdatefrom:null,searchdateto:null,listusertypes:null,listwholesalecustomer:null,listretailcustomer:null,listgoldsmithcustomer:null,listvalueaddition:null,listcategory:null,liststore:null,listpackage:null,listsubmenu:null,listcustomer:null,currentstock:null,transactionsummary:null,transactiondetails:null,transactiondetailshistory:null,transactiondata:null,packagecode:[{puregold:"G1000",gold995:"G9950",oldgold:"G0001",ornamentgold:"G995*",cash:"C1000",bill:"B1000"}],productcode:[{gold:"PW995",makingcharge:"PA202",makingexpense:"PW102",valueaddition:"PW103",stoneweight:"PW105",stonevalue:"PA203",wastage:"PW107",category:"PC101",oldgold:"PW101",testweight:"PW104",testreturn:"PW106",puregold:"PW100",testpurity:"PC102",cash:"PA100"}],addonproductcode:[{metal:"PW995",oldgold:"PW101",cash:"PA100",bill:"RD100",online:"ES100",order:"RD101"}],transactiontype:[{sales:"1",purchase:"2",salesreturn:"3",ogtest:"4",issue:"5","return":"6",cashpayment:"7",cashreceipt:"8",order:"9"}],customertype:[{wholesale:"1",retail:"2",goldsmith:"3",guest:"4",employee:"5",admin:"6",order:"7",self:"100"}],storetype:[{display:"1",godown:"2"}],outstandingtype:[{weightbalance:"1",cashbalance:"2"}]},get:function(key){return this.appvars[key]},set:function(key,value){this.appvars[key]=value}}}).factory("$store",function($parse){var storage=typeof window.localStorage==="undefined"?undefined:window.localStorage,supported=!(typeof storage=="undefined"||typeof window.JSON=="undefined");var privateMethods={parseValue:function(res){var val;try{val=JSON.parse(res);if(typeof val=="undefined"){val=res}if(val=="true"){val=true}if(val=="false"){val=false}if(parseFloat(val)==val&&!angular.isObject(val)){val=parseFloat(val)}}catch(e){val=res}return val}};var publicMethods={set:function(key,value){if(!supported){try{$.cookie(key,value);return value}catch(e){logger.logWarning("failed to load items, please make sure you have $.cookie supported in your browser.")}}var saver=JSON.stringify(value);storage.setItem(key,saver);return privateMethods.parseValue(saver)},get:function(key){if(!supported){try{return privateMethods.parseValue($.cookie(key))}catch(e){return null}}var item=storage.getItem(key);return privateMethods.parseValue(item)},remove:function(key){if(!supported){try{$.cookie(key,null);return true}catch(e){return false}}storage.removeItem(key);return true},bind:function($scope,key,def){def=def||"";if(!publicMethods.get(key)){publicMethods.set(key,def)}$parse(key).assign($scope,publicMethods.get(key));$scope.$watch(key,function(val){publicMethods.set(key,val)},true);return publicMethods.get(key)}};return publicMethods}).factory("filterfunction",function($rootScope,$http,$store,appvariables){var privateMethods={};privateMethods.listpackage=function(){var listpkg=$store.get("pkg");if(listpkg==null||listpkg=="undefined"||listpkg==""){var formData={usercompany:$rootScope.company};$http.post("/service/listpackage",formData).success(function(data){if(data[0].result=="NODATA"&&data[0].result=="ERROR"){logger.logError("unable to load items . please contact support")}else{$store.set("pkg",data);listpkg=$store.get("pkg")}})}return listpkg};var publicMethods={};publicMethods.arrUnique=function(arr){var cleaned=[];arr.forEach(function(itm){var unique=true;cleaned.forEach(function(itm2){if(_.isEqual(itm,itm2))unique=false});if(unique)cleaned.push(itm)});return cleaned};publicMethods.filterarray=function(jsonobject,filtercriteria){var result=[];var my_object=JSON.parse(JSON.stringify(jsonobject));my_object.filter(function(obj){Object.keys(filtercriteria).every(function(c){if(obj[c]==filtercriteria[c]){result.push(obj)}})});return result};publicMethods.getpackagenames=function(packagetype){var pkglist=privateMethods.listpackage();$rootScope.packagestemp=pkglist;var filteredpackagenames=new Array;var strlength=0;if(packagetype.length>0){strlength=packagetype.length;var pkgkeywild="";var pkgkeywhole="";if(packagetype.substring(strlength-1,strlength)=="*"){pkgkeywild=packagetype.substring(0,strlength-1)}else{pkgkeywhole=packagetype}if(pkgkeywhole.length>0||pkgkeywild.length>0){for(var key in pkglist){if(pkgkeywhole.length>0){if(pkglist[key].packages_code==pkgkeywhole){filteredpackagenames.push({packages_id:pkglist[key].packages_id,packages_code:pkglist[key].packages_code,package_name:pkglist[key].package_name,purity:pkglist[key].products_purity,productid:pkglist[key].products_id,productcode:pkglist[key].product_code})}}else if(pkgkeywild.length>0){if(pkglist[key].packages_code.substring(0,pkglist[key].packages_code.length-1)==pkgkeywild){filteredpackagenames.push({packages_id:pkglist[key].packages_id,packages_code:pkglist[key].packages_code,package_name:pkglist[key].package_name,purity:pkglist[key].products_purity,productid:pkglist[key].products_id,productcode:pkglist[key].product_code})}}}}}else{filteredpackagenames.push({packages_id:"0",packages_code:"error",package_name:"error"})}filteredpackagenames=publicMethods.arrUnique(filteredpackagenames);return filteredpackagenames};publicMethods.getpackagedetails=function(packagetype){var pkglist=privateMethods.listpackage();var filteredpackagelist=new Array;if(packagetype.length>0){for(var key in pkglist){if(pkglist[key].packages_code==packagetype){filteredpackagelist.push(pkglist[key])}}}return filteredpackagelist};return publicMethods}).factory("cookieservice",["$cookies",function($cookies){var publicMethods={};publicMethods.setCookieData=function(keyname,keyvalue){$cookies.put(keyname,keyvalue)};publicMethods.getCookieData=function(keyname){return $cookies.get(keyname)};publicMethods.clearCookieData=function(keyname){$cookies.remove(keyname)};return publicMethods}]).factory("utilities",function(){var privateMethods={};privateMethods.s4=function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)};privateMethods.guid=function(){return privateMethods.s4()+privateMethods.s4()+"-"+privateMethods.s4()+"-"+privateMethods.s4()+"-"+privateMethods.s4()+"-"+privateMethods.s4()+privateMethods.s4()+privateMethods.s4()};var publicMethods={};publicMethods.date2Format=function(input,format){var varDate=new Date(input);var month=new Array("01","02","03","04","05","06","07","08","09","10","11","12");var customDate=new Array("01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31");var dd=customDate[varDate.getDate()-1];var mm=month[varDate.getMonth()];var yy=varDate.getFullYear();switch(format){case"dd/mm/yyyy":return dd+"/"+mm+"/"+yy;break;case"mm/dd/yyyy":return mm+"/"+dd+"/"+yy;break;case"yyyy/mm/dd":return yy+"/"+mm+"/"+dd;break;case"dd-mm-yyyy":return dd+"-"+mm+"-"+yy;break;case"yyyy-mm-dd":return yy+"-"+mm+"-"+dd;break;case"dd-mm-yy":return dd+"-"+mm+"-"+yy.substring(yy.length-2,yy.length);break;default:return varDate.getFullYear()+"-"+month[varDate.getMonth()]+"-"+customDate[varDate.getDate()-1];break}};publicMethods.goBackDays=function(fromdate,daystogoback){var days=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];var goBackDays=daystogoback;var today=new Date;var daysSorted=[];for(var i=0;i<goBackDays;i++){var newDate=new Date(today.setDate(today.getDate()-1));if(days[newDate.getDay()]!="Sunday"){daysSorted.push(days[newDate.getDay()])}}return daysSorted.reverse()};publicMethods.roundtodecimal=function(value,exp){if(typeof exp==="undefined"||+exp===0)return Math.round(value);value=+value;exp=+exp;if(isNaN(value)||!(typeof exp==="number"&&exp%1===0))return 0;value=value.toString().split("e");value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+exp:exp)));value=value.toString().split("e");return+(value[0]+"e"+(value[1]?+value[1]-exp:-exp))};publicMethods.generateguid=function(){return privateMethods.guid()};publicMethods.limitkeypresstolength=function($event,value,maxLength){if(value!=undefined&&value.toString().length>=maxLength){$event.preventDefault()}};publicMethods.limitkeypresstonumbers=function($event){if(isNaN(String.fromCharCode($event.keyCode))){$event.preventDefault()}};publicMethods.limitkeypresstonospecialchars=function($event){var k=e.keyCode;if(k>64&&k<91||k>96&&k<123||k==8||k>=48&&k<=57){$event.preventDefault()}};publicMethods.randombetween=function(min,max){if(min<0){return min+Math.random()*(Math.abs(min)+max)}else{return min+Math.random()*max}};return publicMethods}).factory("datepickerfunctions",function($rootScope){var publicMethods={};publicMethods.open1=function($event){$event.preventDefault();$event.stopPropagation();return $scope.opened1=true};publicMethods.open=function($event){$event.preventDefault();$event.stopPropagation();return $scope.opened=true};publicMethods.opensm=function($event){$event.preventDefault();$event.stopPropagation();return $scope.opened1sm=true};publicMethods.open1sm=function($event){$event.preventDefault();$event.stopPropagation();return $scope.openedsm=true};publicMethods.dateOptions={"year-format":"'yy'","starting-day":1};publicMethods.formats=["dd-MMMM-yyyy","yyyy/MM/dd","shortDate"];publicMethods.format=$scope.formats[0];return publicMethods}).directive("ngOnlyNumber",function(){return{restrict:"AE",link:function(scope,elem,attr){if(!$(elem).attr("min")){$(elem).attr("min",0)}function toIncreaseMaxLengthBy(elem){var maxDecimalPoints=elem.data("maxDecimalPoints");return 1+maxDecimalPoints}var el=$(elem)[0];el.initMaxLength=elem.data("maxLength");el.maxDecimalPoints=elem.data("maxDecimalPoints");var checkPositive=function(elem,ev){try{var el=$(elem)[0];if(el.value.indexOf(".")>-1){if(ev.charCode>=48&&ev.charCode<=57){if(el.value.indexOf(".")==el.value.length-toIncreaseMaxLengthBy(elem)){if(el.selectionStart>el.value.indexOf(".")){return false}else{if(el.value.length==elem.data("maxLength")){return false}else{return true}}}else{if(el.selectionStart<=el.value.indexOf(".")){if(el.value.indexOf(".")==toIncreaseMaxLengthBy(elem)){return false}}}}}else{if(el.value.length==elem.data("maxLength")){if(ev.charCode==46){if(typeof el.maxDecimalPoints==="undefined"){return true}else{if(el.selectionStart<el.value.length-el.maxDecimalPoints){return false}}elem.data("maxLength",el.initMaxLength+toIncreaseMaxLengthBy(elem));return true}else if(ev.charCode>=48&&ev.charCode<=57){return false}}if(ev.charCode==46){if(el.selectionStart<el.value.length-elem.data("maxDecimalPoints")){return false}else{return true}}}if(ev.charCode==46){if(el.value.indexOf(".")>-1){return false}else{return true}}if(ev.charCode==43||ev.charCode==45){return true}if((ev.charCode<48||ev.charCode>57)&&ev.charCode!=0){return false}}catch(err){}};var change_maxlength=function(elem,ev){try{var el=$(elem)[0];if(el.value.indexOf(".")>-1){elem.data("maxLength",el.initMaxLength+toIncreaseMaxLengthBy(elem))}else{if(elem.data("maxLength")==el.initMaxLength+toIncreaseMaxLengthBy(elem)){var dot_pos_past=el.selectionStart;el.value=el.value.substring(0,dot_pos_past)}elem.data("maxLength",el.initMaxLength)}}catch(err){}};$(elem).on("keypress",function(){return checkPositive(elem,event)});$(elem).on("input",function(){return change_maxlength(elem,event)})}}}).directive("ngOnlyCharacter",function(){return{restrict:"AE",scope:true,link:function(scope,elem,attr){if(!$(elem).attr("min")){$(elem).attr("min",0)}var checkPositive=function(elem,ev){try{var el=$(elem)[0];if(event.charCode>47&&event.charCode<58||event.charCode>64&&event.charCode<91||event.charCode>96&&event.charCode<123||event.charCode==8||event.charCode==32||event.charCode==46||event.charCode==44||event.charCode==47){return true}else{return false}}catch(err){}};$(elem).on("keypress",function(){return checkPositive(elem,event)})}}}).directive("limitTo",[function(){return{restrict:"A",link:function(scope,elem,attrs){var limit=parseInt(attrs.limitTo);angular.element(elem).on("keypress",function(e){if(this.value.length==limit)e.preventDefault()})}}}]).directive("enter",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){if(event.which===13){event.preventDefault();var fields=$(this).parents("form:eq(0),body").find("input, textarea, select");var index=fields.index(this);if(index>-1&&index+1<fields.length)fields.eq(index+1).focus()}})}}).factory("focus",function($timeout,$window){return function(id){$timeout(function(){var element=$window.document.getElementById(id);if(element)element.focus()})}}).directive("rfocus",function(){return{restrict:"A",controller:function($scope,$element,$attrs){var fooName="setFocus"+$attrs.rfocus;$scope[fooName]=function(){$element.focus()}}}}).directive("selectOnClick",function(){return function(scope,element,attrs){element.bind("click",function(){this.select()});element.bind("focus",function(){this.select()})}}).directive("select2",function($timeout){return{restrict:"AC",link:function(scope,element,attrs){$timeout(function(){element.show();$(element).select2()})}}});"use strict";robs.controller("logincontroller",["$scope","loginService","$rootScope","$location","logger","appvariables","$cookies",function($scope,loginService,$rootScope,$location,logger,appvariables,$cookies){$rootScope.userdata={loginid:"",loginpassword:"",usercompany:$rootScope.company,currentdate:$rootScope.currentdate,password1:"",password2:"",customer:$rootScope.loggedinuser,selectedappuser:""};$scope.signin=function(userdata){loginService.signin(userdata,function(response){if(response!=undefined){if(response[0].RESULT=="ERROR"||response[0].RESULT=="NODATA"){logger.logError("invalid credentials");return}else{logger.logSuccess("successfully logged in");loginService.opendaystock(userdata,function(response){logger.logSuccess("day stock verified and updated.")});$rootScope.setappdata(response[0],userdata.remember);appvariables.set("retailrate",response[1].boardrate);appvariables.set("wholesalerate",response[1]["995rate"]);appvariables.set("rateupdateddatetime",response[1].ChangedDateTime);$rootScope.listsubmenu=response[2];if(($rootScope.listsubmenu+"").length>0){localStorage.setItem("MenuItems",JSON.stringify(response[2]));$rootScope.loadmenu()}$rootScope.showheader=true;$rootScope.showfooterrate=true;$location.path("/")}}else{logger.logWarning("invalid credentials")}})};$scope.signout=function(){loginService.signout(function(data){if(data!=undefined){$rootScope.showheader=false;$rootScope.showfooterrate=false;delete $cookies["jewarSession"];$rootScope.checkSesssion();$location.path("/signin")}else{logger.logWarning("unable to logout")}})};$scope.pathChange=function(path){$location.path(path.link)};$scope.gohome=function(){$location.path("/")};$scope.getmetalrate=function(){loginService.getrate($rootScope.userdata,function(response){$rootScope.metalrate=response;if(response[0].result!="NODATA"&&response[0].result!="ERROR"){$rootScope.wholesalerate=response[0].boardrate;$rootScope.retailrate=response[0].rate995;$rootScope.rateupdateddatetime=response[0].createddatetime}else{logger.logError("metal rates not available. please contact support")}})};$scope.changepassword=function(){$location.path("/changepassword")};$scope.savepassword=function(){if($rootScope.userdata.password1!=$rootScope.userdata.password2){logger.logWarning("password not matching. please re-enter and try again.");return}loginService.savepassword($rootScope.userdata,function(response){if(response!=undefined){if(response[0].RESULT=="ERROR"||response[0].RESULT=="NODATA"){logger.logError("failed to save new password");return}else{logger.logSuccess("password changed successfully");$rootScope.userdata.password1="";$rootScope.userdata.password2="";$location.path("/")}}else{logger.logWarning("invalid credentials")}})};$scope.initchangepassword=function(){var formdata={company:$rootScope.company,customertype:""};loginService.loadcustomer(formdata,function(data){if(data!=undefined){$scope.appusers=data}else{logger.logWarning("unable to load application users.")}})};$scope.onchangecustomer=function(appuser){$rootScope.userdata.selectedappuser=appuser.customerid}}]);"use strict";robs.controller("enrollmentcontroller",["$http","$scope","$location","$rootScope","logger","enrollmentservice","appvariables","utilities",function($http,$scope,$location,$rootScope,logger,enrollmentservice,appvariables,utilities){$rootScope.enrolldata={company:$rootScope.company,orgname:"",firstname:"",lastname:"",loginid:"",loginpassword:"",loginpassword2:"",title:"",contactname:"",userid:$rootScope.loggedinuser,customer:0,customertype:"1",accesstype:7,house:"",street:"",postoffice:"",district:"palakkad",state:"kerala",country:"india",pin:"",contactno:"",email:"",fax:"",geotag:"",creditlimitweight:0,creditlimitcash:0,openingbalanceweight:0,openingbalancecash:0,wholesalerate:0,retailrate:0};$scope.listuser=function($scope){$rootScope.allcustomerlist="";enrollmentservice.listuser($rootScope.enrolldata,function(response){if(response!=undefined){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){$rootScope.allcustomerlist=response}else{logger.logError("unable to load customers. please contact support")}}else{logger.logWarning("user list not available")}})};$scope.saveuser=function(data){if($rootScope.enrolldata.firstname.length==0){logger.logWarning("please enter customer name");return}else if($rootScope.enrolldata.orgname.length==0){logger.logWarning("please enter shop name");return}else if($rootScope.enrolldata.contactno.length==0&&$rootScope.enrolldata.customertype<4){logger.logWarning("invalid customer contact number");return}else if(($rootScope.enrolldata.creditlimitcash==0||isNaN($rootScope.enrolldata.creditlimitcash))&&$rootScope.enrolldata.customertype==2){logger.logWarning("invalid cash credit limit");return}else if(($rootScope.enrolldata.creditlimitweight==0||isNaN($rootScope.enrolldata.creditlimitweight))&&$rootScope.enrolldata.customertype==1){logger.logWarning("invalid weight credit limit");return}else if(($rootScope.enrolldata.creditlimitweight==0||isNaN($rootScope.enrolldata.creditlimitweight))&&$rootScope.enrolldata.customertype==3){logger.logWarning("invalid weight credit limit");return}else if($rootScope.enrolldata.loginid.length==0||$rootScope.enrolldata.loginpassword.length==0){if($rootScope.enrolldata.customertype==appvariables.get("customertype")[0].employee){logger.logWarning("please enter operator login id and password (8 characters)");return}else{if($rootScope.enrolldata.loginid.length==0){$rootScope.enrolldata.loginid=$rootScope.enrolldata.firstname.substring(0,3)+utilities.randombetween(1e3,9999);$rootScope.enrolldata.loginpassword="12345678"}else{}}}else if($rootScope.enrolldata.loginpassword!=$rootScope.enrolldata.loginpassword2){logger.logWarning("password not matching");return}enrollmentservice.saveuser($rootScope.enrolldata,function(response){if(response!=undefined){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){logger.logSuccess("user details saved successfully");$scope.listuser();$scope.cleardata()}else{logger.logError("unable to register user. please contact support")}}else{logger.logWarning("user list not available")}})};$scope.edituser=function(customer){for(var i in $rootScope.allcustomerlist){if($rootScope.allcustomerlist[i].customerid==customer.customerid){$rootScope.enrolldata.customer=customer.customerid;$rootScope.enrolldata.orgname=$rootScope.allcustomerlist[i].orgname;$rootScope.enrolldata.firstname=$rootScope.allcustomerlist[i].firstname;$rootScope.enrolldata.lastname=$rootScope.allcustomerlist[i].lastname;$rootScope.enrolldata.contactno=$rootScope.allcustomerlist[i].contactno;$rootScope.enrolldata.house=$rootScope.allcustomerlist[i].house;$rootScope.enrolldata.street=$rootScope.allcustomerlist[i].street;$rootScope.enrolldata.postoffice=$rootScope.allcustomerlist[i].koppam;$rootScope.enrolldata.district=$rootScope.allcustomerlist[i].Palakkad;$rootScope.enrolldata.pin=$rootScope.allcustomerlist[i].pin;$rootScope.enrolldata.creditlimitweight=$rootScope.allcustomerlist[i].creditlimitweight;$rootScope.enrolldata.creditlimitcash=$rootScope.allcustomerlist[i].creditlimitcash;$rootScope.enrolldata.openingbalanceweight=$rootScope.allcustomerlist[i].opbalanceweight;$rootScope.enrolldata.openingbalancecash=$rootScope.allcustomerlist[i].opbalancecash;var formdata={pcode:$rootScope.allcustomerlist[i].loginid};enrollmentservice.getpass(formdata,function(response){$rootScope.enrolldata.loginid=response[0].pcode})}}};$scope.deleteuser=function(customer){if(customer!=undefined|customer.length>0){$rootScope.enrolldata.customer=customer.customerid;enrollmentservice.deleteuser($rootScope.enrolldata,function(response){if(response!=undefined){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){logger.logSuccess("user removed saved successfully");$scope.listuser()}else{logger.logError("unable to remove user. please contact support")}}else{logger.logWarning("failed to remove user.")}})}else{logger.logWarning("please select a user.")}};$scope.setrate=function(){if($rootScope.enrolldata.wholesalerate==0||isNaN($rootScope.enrolldata.wholesalerate)){logger.logWarning("invalid wholesale rate");return}else if($rootScope.enrolldata.retailrate==0||isNaN($rootScope.enrolldata.retailrate)){logger.logWarning("invalid retail rate");return}enrollmentservice.setrate($rootScope.enrolldata,function(response){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){$rootScope.metalrate=response[0];logger.logSuccess("rates change success.");$rootScope.wholesalerate=response[0][0].boardrate;$rootScope.retailrate=response[0][0].rate995;appvariables.set("wholesalerate",$rootScope.wholesalerate);appvariables.set("retailrate",$rootScope.retailrate);$rootScope.rateupdateddatetime=response[0].createddatetime}else{logger.logError("failed to update metal rates. please contact support")}})};$scope.transactionshowdetails=function(){$scope.showtransaction=true};$scope.cleardata=function(){$rootScope.enrolldata.orgname="";$rootScope.enrolldata.firstname="";$rootScope.enrolldata.lastname="";$rootScope.enrolldata.contactno="";$rootScope.enrolldata.house="";$rootScope.enrolldata.street="";$rootScope.enrolldata.postoffice="";$rootScope.enrolldata.district="";$rootScope.enrolldata.pin="";$rootScope.enrolldata.creditlimitweight=0;$rootScope.enrolldata.creditlimitcash=0;$rootScope.enrolldata.openingbalanceweight=0;$rootScope.enrolldata.openingbalancecash=0;$rootScope.enrolldata.wholesalerate=0;$rootScope.enrolldata.retailrate=0};$scope.initcustomer=function(){$rootScope.enrolldata.creditlimitweight=0;$rootScope.enrolldata.creditlimitcash=0;$rootScope.enrolldata.opbalanceweight=0;$rootScope.enrolldata.opbalancecash=0;$rootScope.enrolldata.customertype=5};$scope.listuser();$scope.initrate=function(){$rootScope.enrolldata.wholesalerate=$rootScope.wholesalerate;$rootScope.enrolldata.retailrate=$rootScope.retailrate}}]);"use strict";robs.controller("modalcontroller",["$http","$scope","$rootScope","logger","servicesservice",function($http,$scope,$rootScope,logger,servicesservice){$scope.dialogtransactionhistory=function(){servicesservice.listhistory($rootScope.billdata,function(data){if(data!=undefined){$rootScope.transactiondetailshistory=data;$rootScope.transactionhistoryheaderdetails=data[0];$rootScope.transactionhistorybodydetails=data[1];$rootScope.transactionhistoryheader={customer:$rootScope.transactionhistoryheaderdetails.orgname,owner:$rootScope.transactionhistoryheaderdetails.salesowner,customertype:$rootScope.transactionhistoryheaderdetails.typename,transactiontype:$rootScope.transactionhistoryheaderdetails.transactiontypename,transactiondate:$rootScope.transactionhistoryheaderdetails.transactiondate,receipt:$rootScope.transactionhistoryheaderdetails.receiptno,contactno:$rootScope.transactionhistoryheaderdetails.contactno,status:$rootScope.transactionhistoryheaderdetails.status}}else{logger.logError("transaction history not available.")}})};$scope.dialogtransactionhistory()}]);"use strict";robs.controller("reportcontroller",["$http","$scope","$location","$rootScope","logger","reportservice","printservice","appvariables","filterfunction","utilities","ngDialog","$q","$sce",function($http,$scope,$location,$rootScope,logger,reportservice,printservice,appvariables,filterfunction,utilities,ngDialog,$q,$sce){$rootScope.reportdata={company:$rootScope.company,customer:0,customertype:0,customeroutstandingtype:0,store:0,"package":0,packagecode:"",product:0,productcode:"",category:0,fromdate:$rootScope.currentdate,todate:$rootScope.currentdate,user:$rootScope.loggedinuser,transactiondate:$rootScope.currentdate,billnumber:0};function transactiontypesales(){return 1}function transactiontypepurchase(){return 2}function transactiontypesalesreturn(){return 3}function transactiontypeogtest(){return 4}function transactiontypeissue(){return 5}function transactiontypereturn(){return 6}function transactiontypecashpayment(){return 7}function transactiontypecashreceipt(){return 8}function transactiontypeorder(){return 9}$scope.stock=function(){reportservice.stock($rootScope.reportdata,function(data){if(data!=undefined){$scope.listcurrentstock=data[0];$scope.listcurrentstocktransaction=data[1];$scope.listcurrentstocktransactiondetails=data[2];$scope.listcurrentstockdisplay=filterfunction.filterarray($scope.listcurrentstock,{storeid:appvariables.get("storetype")[0].display});$scope.listcurrentstockgodown=filterfunction.filterarray($scope.listcurrentstock,{storeid:appvariables.get("storetype")[0].godown})}else{logger.logWarning("stock data not available")}})};$scope.liststock=function(){$rootScope.reportdata.fromdate=utilities.date2Format($rootScope.reportdata.fromdate,"yyyy-mm-dd");reportservice.liststock($rootScope.reportdata,function(data){if(data!=undefined){$scope.liststocksummary=data[0];$scope.liststocktransaction=data[1]}else{logger.logWarning("stock data not available for selected date.")}})};$scope.stockhistory=function(data){reportservice.stockhistory($rootScope.reportdata,function(data){if(data!=undefined){$rootScope.liststockhistory=data}else{logger.logWarning("stock history data not available")}})};$scope.packagefilter=function(item){if(item.storeid==1){return item.package_title!="cash"&&item.package_title!="995"&&item.package_title!="oldgold"&&item.package_title!="puregold"}else{return true}};$scope.smith=function(){var smithissue=[];var smithreturn=[];reportservice.smith($rootScope.reportdata,function(data){if(data!=undefined){$rootScope.smithoutstanding=data[0];$rootScope.smithopeningstock=data[1];$rootScope.smithreport=data[2];$rootScope.smithreportdetails=data[3];var issuedetails=filterfunction.filterarray($rootScope.smithreportdetails,{transactiontype:appvariables.get("transactiontype")[0].issue});var returndetails=filterfunction.filterarray($rootScope.smithreportdetails,{transactiontype:appvariables.get("transactiontype")[0].return});var issuegroup=_.groupBy(issuedetails,"transactiondate");var returngroup=_.groupBy(returndetails,"transactionid");for(var key in issuegroup){var currenttransaction;var rowdata;var issuedata={transactiontype:0,transactiondate:"",og:"",ogpurity:0,weight995:0,purity995:995,cash:0,rate:0,item:"",quantity:0,weight:0,netweight:0};currenttransaction=issuegroup[key];for(var row in currenttransaction){rowdata=currenttransaction[row];issuedata.transactiondate=rowdata.transactiondate;issuedata.transactiontype=appvariables.get("transactiontype")[0].issue;if(rowdata.product_code==appvariables.get("productcode")[0].gold){issuedata.weight995=rowdata.productvalue;issuedata.purity995=rowdata.purity}if(rowdata.product_code==appvariables.get("productcode")[0].oldgold){issuedata.og=rowdata.productvalue;issuedata.ogpurity=rowdata.purity}if(rowdata.product_code==appvariables.get("productcode")[0].cash){issuedata.cash=rowdata.productvalue;issuedata.rate=rowdata.rate}if(currenttransaction[+row+ +1]==undefined){var issuelistgroupbytransactionid=filterfunction.filterarray($rootScope.smithreport,{billingdate:key});issuelistgroupbytransactionid=filterfunction.filterarray(issuelistgroupbytransactionid,{transactiontype:appvariables.get("transactiontype")[0].issue});for(var billitem in issuelistgroupbytransactionid){var billdata=issuelistgroupbytransactionid[billitem];issuedata.netweight+=billdata.calculatedweight}issuedata.netweight=utilities.roundtodecimal(issuedata.netweight,3);smithissue.push(issuedata)}}}for(var key in returngroup){var currenttransaction;var rowdata;var returndata={transactiontype:0,transactiondate:"",item:"",quantity:0,weight:0,purity:0,stoneweight:0,valueaddition:0,wastage:0,netweight:0};currenttransaction=returngroup[key];for(var row in currenttransaction){rowdata=currenttransaction[row];returndata.transactiondate=rowdata.transactiondate;returndata.transactiontype=appvariables.get("transactiontype")[0].return;if(rowdata.product_code==appvariables.get("productcode")[0].gold){returndata.item=rowdata.package_name;returndata.quantity=rowdata.quantity;returndata.weight=rowdata.productvalue;returndata.purity=rowdata.purity}else if(rowdata.product_code==appvariables.get("productcode")[0].stoneweight){returndata.stoneweight=rowdata.productvalue}else if(rowdata.product_code==appvariables.get("productcode")[0].wastage){returndata.wastage=rowdata.productvalue}else if(rowdata.product_code==appvariables.get("productcode")[0].valueaddition){returndata.valueaddition=rowdata.productvalue}if(currenttransaction[+row+ +1]==undefined){var netreturnweight=filterfunction.filterarray($rootScope.smithreport,{transactionid:rowdata.transactionid});returndata.netweight=netreturnweight[0].calculatedweight;smithreturn.push(returndata)}}}$rootScope.smithissuelist=smithissue;$rootScope.smithreturnlist=smithreturn}else{logger.logWarning("data not available")}})};$scope.cash=function(){reportservice.cash($rootScope.reportdata,function(data){if(data!=undefined){$rootScope.cashbooksummary=data[0];$rootScope.cashbookreport=data[1]}else{logger.logWarning("data not available")}})};$scope.bill=function(){reportservice.bill($rootScope.reportdata,function(data){if(data!=undefined){$rootScope.customeroutstanding=data[0];$rootScope.billsummary=data[1];$rootScope.billdetailsreport=data[2]}else{logger.logWarning("data not available")}})};$scope.viewbill=function(){reportservice.viewbill($rootScope.reportdata,function(data){if(data!=undefined){$rootScope.customeroutstanding=data[0];$rootScope.billsummary=data[1]}else{logger.logWarning("bill data not available")}})};$scope.editbill=function(data){$rootScope.editbillreceiptno=data.receiptno;$rootScope.editbillcustomer=data.customerid;$rootScope.editbillcustomertype=data.customertype;$rootScope.editbilltransactiondate=utilities.date2Format(data.transactiondate,"yyyy/mm/dd");$location.path("/editbill")};$scope.generatebill=function(billrow){$rootScope.base64encodedpdf="";var printoptions={company:$rootScope.company,customer:billrow.customerid,customertype:billrow.customertype,transactionlist:0,billtype:"salesbill",receiptno:billrow.receiptno,fromdate:$rootScope.reportdata.fromdate,todate:$rootScope.reportdata.todate,billdatafromclient:$rootScope.transactionalcharges,action:"view"};printservice.salesbill(printoptions,function(response){$rootScope.base64encodedpdf=$sce.trustAsResourceUrl(response)});ngDialog.open({template:"modelcustomerbill",className:"ngdialog-theme-default custom-width",closeByDocument:false})};$scope.salesreturn=function(){reportservice.salesreturn($rootScope.reportdata,function(data){if(data!=undefined){$rootScope.customeroutstanding=data[0];$rootScope.billsummary=filterfunction.filterarray(data[1],{transactiontype:appvariables.get("transactiontype")[0].salesreturn});$rootScope.billdetailsreport=filterfunction.filterarray(data[2],{transactiontype:appvariables.get("transactiontype")[0].salesreturn})}else{logger.logWarning("data not available")}})};$scope.cumilativereport=function(){if($rootScope.reportdata.customer==0){logger.logWarning("Please select customer");
return}reportservice.cumilativereport($rootScope.reportdata,function(data){if(data!=undefined){$rootScope.customeroutstanding=data[0];$rootScope.customeropbalance=data[2];$rootScope.billsummary=data[1]}else{logger.logWarning("data not available")}})};$scope.order=function(){reportservice.order($rootScope.reportdata,function(data){if(data!=undefined){$rootScope.customeroutstanding=data[0];$rootScope.billsummary=filterfunction.filterarray(data[3],{transactiontype:appvariables.get("transactiontype")[0].order});$rootScope.billdetailsreport=filterfunction.filterarray(data[2],{transactiontype:appvariables.get("transactiontype")[0].order})}else{logger.logWarning("data not available")}})};$scope.daybook=function(){reportservice.daybook($rootScope.reportdata,function(data){if(data!=undefined){$scope.daybookdata=data[0];$scope.daybookreceiptdata=data[1];$scope.daybookdatadetails=data[2];$scope.billcount=$scope.daybookreceiptdata.totalreceiptno;$scope.salescount=0,$scope.salesweight=0,$scope.purchasecount=0,$scope.purchaseweight=0,$scope.salesreturncount=0,$scope.salesreturnweight=0,$scope.smithissuecount=0,$scope.smithissueweight=0,$scope.smithreturncount=0,$scope.smithreturnweight=0,$scope.cashissuecount=0,$scope.cashissueweight=0,$scope.cashreceiptcount=0,$scope.cashreceiptweight=0,$scope.ordercount=0,$scope.orderweight=0,$scope.billcount=0;var item;for(var row in $scope.daybookdata){item=$scope.daybookdata[row];switch(+item.transactiontype){case 1:$scope.salescount=item.totalquantity;$scope.salesweight=item.totalvalue;break;case 2:$scope.purchasecount=item.totalquantity;$scope.purchaseweight=item.totalvalue;break;case 3:$scope.salesreturncount=item.totalquantity;$scope.salesreturnweight=item.totalvalue;break;case 4:break;case 5:$scope.smithissuecount=item.totalquantity;$scope.smithissueweight=item.totalvalue;break;case 6:$scope.smithreturncount=item.totalquantity;$scope.smithreturnweight=item.totalvalue;break;case 7:$scope.cashissuecount=item.totalquantity;$scope.cashissueweight=item.totalvalue;break;case 8:$scope.cashreceiptcount=item.totalquantity;$scope.cashreceiptweight=item.totalvalue;break;case 9:$scope.ordercount=item.totalquantity;$scope.orderweight=item.totalvalue;break}}}else{logger.logWarning("data not available")}})};$scope.dashboard=function(){reportservice.dashboard($rootScope.reportdata,function(data){if(data!=undefined){$rootScope.transactioncustomertrend=data[0];$rootScope.metalpositiontrend=data[1];$rootScope.oustanderstrend=data[2];$rootScope.ordertrend=data[3];$rootScope.ordersnearingdelivery=data[4];var today=new Date;var last7days=[];var days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var tdate=today;for(var i=0;i<7;i++){tdate=new Date(tdate.setDate(today.getDate()-i));if(days[tdate.getDay()]!="Sunday"){last7days.push(utilities.date2Format(tdate,"dd-mm-yyyy"))}}last7days=last7days.reverse();$scope.last7days=utilities.goBackDays(today,7);var transactiontrendbody=[];var transactionsmithbody=[];var metalpositionbody=[];var topoustanderswithsalesbody=[];var orderdata=[];var ratebody=[];var orderbody=[];var ratefluctuationbody=[];var data=$rootScope.transactioncustomertrend;var dataRowsales=[];var dataRowpurchase=[];var dataRoworder=[];var dataRowsalesreturn=[];var dataGsissue=[];var dataGsreturn=[];var datametalposition=[];var datatopoutstander=[];var datatopoutstanderbalancedata=[];var datatopoutstandersalesdata=[];data.forEach(function(row){if(row.transactiontype==transactiontypesales()){dataRowsales.push(row.amount==null?"0":row.amount.toString())}if(row.transactiontype==transactiontypepurchase()){dataRowpurchase.push(row.amount==null?"0":row.amount.toString())}if(row.transactiontype==transactiontypeorder()){dataRoworder.push(row.amount==null?"0":row.amount.toString())}if(row.transactiontype==transactiontypesalesreturn()){dataRowsalesreturn.push(row.amount==null?"0":row.amount.toString())}if(row.transactiontype==transactiontypeissue()){dataGsissue.push(row.amount==null?"0":row.amount.toString())}if(row.transactiontype==transactiontypereturn()){dataGsreturn.push(row.amount==null?"0":row.amount.toString())}if(row.transactiontype==transactiontypeorder()){dataRoworder.push(row.amount==null?"0":row.amount.toString())}});transactiontrendbody.push(dataRowsales);transactiontrendbody.push(dataRowpurchase);transactiontrendbody.push(dataRoworder);transactiontrendbody.push(dataRowsalesreturn);transactionsmithbody.push(dataGsissue);transactionsmithbody.push(dataGsreturn);orderbody.push(dataGsissue);var trend=$rootScope.metalpositiontrend;var outstanding,golddsmith,instock,display;trend.forEach(function(row){if(row.outstandingweight=="outstandingweight"){outstanding=row.Sum_outstandingweight==null?"0":row.Sum_outstandingweight.toString()}else if(row.outstandingweight=="goldsmithoutstandingweight"){golddsmith=row.Sum_outstandingweight==null?"0":row.Sum_outstandingweight.toString()}else if(row.outstandingweight=="stockweight"){instock=row.Sum_outstandingweight==null?"0":row.Sum_outstandingweight.toString()}else if(row.outstandingweight=="displayweight"){display=row.Sum_outstandingweight==null?"0":row.Sum_outstandingweight.toString()}});datametalposition.push(outstanding);datametalposition.push(golddsmith);datametalposition.push(instock);metalpositionbody.push(datametalposition);var topoutstander=$rootScope.oustanderstrend;topoutstander.forEach(function(row){datatopoutstander.push(row.orgname);datatopoutstanderbalancedata.push(row.avgoutstandingweight);datatopoutstandersalesdata.push(row.avgsaleweight)});topoustanderswithsalesbody.push(datatopoutstanderbalancedata);topoustanderswithsalesbody.push(datatopoutstandersalesdata);var orderlist=$rootScope.ordertrend;var outstanding,golddsmith,instock,display,rowproductvalue;var orderdays=[];var neworderdata=[];var newDate=today;for(var i=0;i<7;i++){newDate=new Date(newDate.setDate(today.getDate()-i));var newDatevalue=utilities.date2Format(newDate,"yyyy-mm-dd");if(days[newDate.getDay()]!="Sunday"){orderdays.push(utilities.date2Format(newDatevalue,"dd-mm-yyyy"));rowproductvalue=0;orderlist.forEach(function(row){if(utilities.date2Format(row.transactiondate,"yyyy-mm-dd")==newDatevalue){rowproductvalue=row.Sum_productvalue}});neworderdata.push(rowproductvalue)}}neworderdata=neworderdata.reverse();orderdata.push(neworderdata);orderdays=orderdays.reverse();$rootScope.transactiontrendchartData={labels:last7days,series:["sales","purchase","order","salesreturn"],data:transactiontrendbody};$rootScope.transactiontrendchartdatasetOverride=[{label:"Line chart",fill:false,legend:true}];$rootScope.transactiontrendchartoptions={label:"Line chart"};$rootScope.transactionsmithchartData={labels:last7days,series:["issue","return"],data:transactionsmithbody};$rootScope.transactionsmithchartdatasetOverride=[{label:"Line chart",borderWidth:3,hoverBackgroundColor:"rgba(255,99,132,0.4)",hoverBorderColor:"rgba(255,99,132,1)",type:"line",datasetFill:true,legend:true}];$rootScope.transactionsmithchartoptions={scales:{yAxes:[{id:"y-axis-1",type:"line",display:true,position:"left"}]}};$rootScope.metalpositionchartoptions={labels:true,legend:{display:true,position:"right"}};$rootScope.metalpositionchartData={labels:["outStanding","goldSmith","stock"],data:datametalposition};$rootScope.topoustanderswithsaleschartData={labels:datatopoutstander,series:["outstanding","sales"],data:topoustanderswithsalesbody};$rootScope.orderchartData={labels:orderdays,series:["weight"],data:orderdata};$rootScope.orderchartdatasetOverride=[{label:"Line chart",fill:false,legend:true}];$rootScope.orderchartoptions={label:"Line chart"};$rootScope.ratechartData={labels:$scope.last7days,series:["board rate"],data:ratebody};$rootScope.ratechartdatasetOverride=[{label:"Line chart",borderWidth:3,hoverBackgroundColor:"rgba(255,99,132,0.4)",hoverBorderColor:"rgba(255,99,132,1)",type:"line",datasetFill:true,legend:true}];$rootScope.ratechartoptions={scales:{yAxes:[{id:"y-axis-1",type:"line",display:true,position:"left"}]}}}else{logger.logWarning("data not available")}})};$scope.open=function($event,index){$event.preventDefault();$event.stopPropagation();$scope.opened=new Array;return $scope.opened[index]=true};$scope.dateOptions={"year-format":"'yy'","starting-day":1};$scope.loadcustomer=function(customertype){$rootScope.reportdata.customertype=customertype;reportservice.loadcustomer($rootScope.reportdata,function(data){if(data!=undefined){$rootScope.listcustomer=data}else{logger.logWarning("unable to load smith.")}})};$scope.onchangecustomer=function(customer){$rootScope.reportdata.customer=customer.customerid};$scope.calculategns=function(){$rootScope.reportdata.fromdate=utilities.date2Format($rootScope.reportdata.fromdate,"yyyy-mm-dd");$rootScope.reportdata.todate=utilities.date2Format($rootScope.reportdata.todate,"yyyy-mm-dd");reportservice.calculategns($rootScope.reportdata,function(data){if(data!=undefined){var netsale=0,netsalestone=0,netsalesreturn=0,netsalesreturnstone=0;var rowdata;$rootScope.netgns=0;for(var row in data[0]){rowdata=data[0][row];if(rowdata.transactiontype==appvariables.get("transactiontype")[0].sales&&rowdata.productid==1){netsale=rowdata.netweight}else if(rowdata.transactiontype==appvariables.get("transactiontype")[0].sales&&rowdata.productid==8){netsalestone=rowdata.netweight}else if(rowdata.transactiontype==appvariables.get("transactiontype")[0].salesreturn&&rowdata.productid==1){netsalesreturn=rowdata.netweight}else if(rowdata.transactiontype==appvariables.get("transactiontype")[0].salesreturn&&rowdata.productid==8){netsalesreturnstone=rowdata.netweight}}$rootScope.netgns=utilities.roundtodecimal(+netsale-+netsalestone-(+netsalesreturn-+netsalesreturnstone),3)}else{logger.logWarning("gns retrievel failes.")}})};$scope.initstockreport=function(){$rootScope.reportdata.fromdate=$rootScope.currentdate;$rootScope.reportdata.todate=$rootScope.currentdate;$scope.showstockhistory=false;$scope.stock();$scope.stocktransactionexpanded=false;$scope.stocktransactiondetailsexpanded=false};$scope.initliststockreport=function(){$rootScope.reportdata.fromdate=$rootScope.currentdate;$rootScope.reportdata.todate=$rootScope.currentdate;$scope.liststock()};$scope.initcashreport=function(){$rootScope.reportdata.fromdate=$rootScope.currentdate;$rootScope.reportdata.todate=$rootScope.currentdate;$rootScope.reportdata.package=appvariables.get("packagecode")[0].cash;$scope.cash()};$scope.initsmithreport=function(){$rootScope.reportdata.fromdate=$rootScope.currentdate;$rootScope.reportdata.todate=$rootScope.currentdate;$scope.loadcustomer(appvariables.get("customertype")[0].goldsmith);$scope.smith()};$scope.initbillreport=function(){$rootScope.reportdata.fromdate=$rootScope.currentdate;$rootScope.reportdata.todate=$rootScope.currentdate;$scope.loadcustomer("");$scope.viewbill()};$scope.initsalesreturnreport=function(){$rootScope.reportdata.fromdate=$rootScope.currentdate;$rootScope.reportdata.todate=$rootScope.currentdate;$scope.loadcustomer("");$scope.salesreturn()};$scope.initcumilationreport=function(){$rootScope.reportdata.fromdate=$rootScope.currentdate;$rootScope.reportdata.todate=$rootScope.currentdate;$scope.loadcustomer("")};$scope.initdaybookreport=function(){$rootScope.reportdata.fromdate=$rootScope.currentdate;$rootScope.reportdata.todate=$rootScope.currentdate;$scope.daybook()};$scope.initorderreport=function(){$rootScope.reportdata.fromdate=$rootScope.currentdate;$rootScope.reportdata.todate=$rootScope.currentdate;$scope.loadcustomer("");$scope.order()};$scope.initdashboard=function(){$rootScope.reportdata.fromdate=$rootScope.currentdate;$rootScope.reportdata.todate=$rootScope.currentdate;$scope.dashboard();$scope.calculategns()};$scope.transactions=function(data){$scope.transactionshow=true;reportservice.transactions(data,$scope)};$scope.sales=function(){reportservice.sales()}}]);"use strict";robs.controller("servicecontroller",["$http","$scope","$location","$rootScope","logger","servicesservice","printservice","appvariables","filterfunction","utilities","ngDialog","$q","$sce",function($http,$scope,$location,$rootScope,logger,servicesservice,printservice,appvariables,filterfunction,utilities,ngDialog,$q,$sce){$rootScope.billdata={company:$rootScope.company,customer:0,customername:"",customertype:1,customeroutstandingtype:0,customercreditlimit:0,customeroutstanding:0,store:0,"package":0,packagecode:"",product:0,productcode:"",category:0,metalrate:0,quantity:0,weight:0,purity:0,makingexpense:0,makingcharge:0,valueaddition:0,wastage:0,stoneweight:0,stonevalue:0,receiptno:0,transactionid:0,transactiondate:$rootScope.currentdate,transactiontype:0,transactiondetail:"",duedate:$rootScope.currentdate,returnquantity:0,returnproductvalue:0,calculatedweight:0,testweight:0,testreturnweight:0,puregoldweight:0,testpurity:0,goldsmithtransactiontype:5,issueoldgoldweight:0,issueoldgoldpurity:0,issueoldgoldnetweight:0,issue995goldweight:0,issue995goldpurity:0,issue995goldnetweight:0,netgoldsmithissueweight:0,netgoldsmithreturnweight:0,cashissued:0,cashreceived:0,netcashissueweight:0,user:$rootScope.loggedinuser,comments:"",selecteditemunit:"gm",updatesummary:0};$rootScope.stockdata={company:$rootScope.company,store:0,"package":0,packagecode:"",category:0,categoryname:"",metalrate:0,quantity:0,weight:0,purity:0,va:0,vamin:0,vamax:0,vapercentage:0,vacustomertype:1,opstockquantity:0,opstockweight:0,diplaystockquantity:0,diplaystockweight:0,godownstockquantity:0,godownstockweight:0,netstockquantity:0,netstockweight:0,totalpackagequantity:0,totalpackageweight:0,diplaystockquantitytemp:0,diplaystockweighttemp:0,godownstockquantitytemp:0,godownstockweighttemp:0,storedisplay:appvariables.get("storetype")[0].display,storegodown:appvariables.get("storetype")[0].godown,transactiondate:$rootScope.currentdate,user:$rootScope.loggedinuser,movementquantity:0,movementweight:0,newdiplaystockquantity:0,newdiplaystockweight:0,newgodownstockquantity:0,newgodownstockweight:0,movementtype:1,comments:""};$rootScope.addressdata={company:$rootScope.company,cname:"",addressline:"",district:"",state:"",contact:0,customertype:appvariables.get("customertype")[0].order};$rootScope.customertransactionsummary={totalsaleqty:0,totalsaleweight:0,totalpurchaseqty:0,totalpurchaseweight:0,totalcash:0,totalsalesreturnqty:0,totalsalesreturnweight:0};$rootScope.editbilldata={company:$rootScope.company,customer:0,customertype:1,store:0,"package":0,packagecode:"",packagename:"",product:0,productcode:"",category:0,categoryname:"",newpackage:0,newpackagecode:"",newpackagename:"",newproduct:0,newproductcode:"",newcategory:0,metalrate:0,quantity:0,weight:0,purity:0,makingexpense:0,makingcharge:0,valueaddition:0,wastage:0,stoneweight:0,stonevalue:0,receiptno:0,transactionid:0,transactiondate:$rootScope.currentdate,transactiontype:0,transactiondetail:"",duedate:$rootScope.currentdate,user:$rootScope.loggedinuser,comments:"",selecteditemunit:"gm",updatesummary:1};$scope.liststore=function(){servicesservice.liststore($rootScope.billdata,function(data){if(data!=undefined){$rootScope.liststores=data}else{logger.logWarning("no store available")}});$rootScope.billdata.store=1;$rootScope.stockdata.store=1};$scope.loadcustomer=function(customertype){$scope.closepanel();$rootScope.transactiondetails=[];$rootScope.transactionsummary=[];$rootScope.transactionbilldetails=[];$rootScope.billdata.customertype=customertype;servicesservice.loadcustomer($rootScope.billdata,function(data){$scope.calculation=false;$scope.expenselist=false;if(data!=undefined){$scope.listcustomer=data;if($rootScope.billdata.customertype==appvariables.get("customertype")[0].self){$scope.billcustomer=$scope.listcustomer[0];$scope.onchangecustomer($scope.billcustomer);$rootScope.billdata.transactiontype=appvariables.get("transactiontype")[0].purchase;$rootScope.billdata.store=appvariables.get("storetype")[0].godown;$rootScope.billdata.metalrate=appvariables.get("wholesalerate")}}else{logger.logWarning("unable to load customer.")}})};$scope.listitemcategory=function(){servicesservice.listcategory($rootScope.billdata,function(data){if(data!=undefined){$scope.listcategories=data}else{logger.logWarning("unable to load category.")}})};$scope.listtransaction=function(){if($rootScope.billdata.customer==0){logger.logWarning("please select customer");return}servicesservice.listtransaction($rootScope.billdata,function(response){if(response!=undefined){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){$rootScope.transactionsummary=response[0];$rootScope.transactiondetails=response[1];$rootScope.transactionbilldetails=response[2];$rootScope.transactiondetailsfordisplay=response[1];$rootScope.customertransactionsummary.totalsaleqty=0;$rootScope.customertransactionsummary.totalsaleweight=0;$rootScope.customertransactionsummary.totalpurchaseqty=0;$rootScope.customertransactionsummary.totalpurchaseweight=0;$rootScope.customertransactionsummary.totalcash=0;$rootScope.customertransactionsummary.totalsalesreturnqty=0;$rootScope.customertransactionsummary.totalsalesreturnweight=0;var currenttransaction;for(var key in $rootScope.transactiondetailsfordisplay){currenttransaction=$rootScope.transactiondetailsfordisplay[key];if(currenttransaction.transactiontype==appvariables.get("transactiontype")[0].sales&&currenttransaction.product_code==appvariables.get("productcode")[0].gold){$rootScope.customertransactionsummary.totalsaleqty+=currenttransaction.quantity;$rootScope.customertransactionsummary.totalsaleweight+=currenttransaction.productvalue}else if(currenttransaction.transactiontype==appvariables.get("transactiontype")[0].purchase&&currenttransaction.product_code==appvariables.get("productcode")[0].oldgold){$rootScope.customertransactionsummary.totalpurchaseqty+=currenttransaction.quantity;$rootScope.customertransactionsummary.totalpurchaseweight+=currenttransaction.productvalue}else if(currenttransaction.transactiontype==appvariables.get("transactiontype")[0].cashreceipt&&currenttransaction.product_code==appvariables.get("productcode")[0].cash){$rootScope.customertransactionsummary.totalcash+=currenttransaction.productvalue}else if(currenttransaction.transactiontype==appvariables.get("transactiontype")[0].salesreturn&&currenttransaction.product_code==appvariables.get("productcode")[0].gold){$rootScope.customertransactionsummary.totalsalesreturnqty+=currenttransaction.quantity;$rootScope.customertransactionsummary.totalsalesreturnweight+=currenttransaction.productvalue}}$rootScope.customertransactionsummary.totalsaleqty=utilities.roundtodecimal($rootScope.customertransactionsummary.totalsaleqty,0);$rootScope.customertransactionsummary.totalsaleweight=utilities.roundtodecimal($rootScope.customertransactionsummary.totalsaleweight,3);$rootScope.customertransactionsummary.totalpurchaseqty=utilities.roundtodecimal($rootScope.customertransactionsummary.totalpurchaseqty,0);$rootScope.customertransactionsummary.totalpurchaseweight=utilities.roundtodecimal($rootScope.customertransactionsummary.totalpurchaseweight,3);$rootScope.customertransactionsummary.totalcash=utilities.roundtodecimal($rootScope.customertransactionsummary.totalcash,2);$rootScope.customertransactionsummary.totalsalesreturnqty=utilities.roundtodecimal($rootScope.customertransactionsummary.totalsalesreturnqty,0);$rootScope.customertransactionsummary.totalsalesreturnweight=utilities.roundtodecimal($rootScope.customertransactionsummary.totalsalesreturnweight,3);if($rootScope.billdata.customertype==appvariables.get("customertype")[0].wholesale){$rootScope.billdata.customercreditlimit=response[0][0].creditlimitweight;$rootScope.billdata.customeroutstanding=response[0][0].outstandingweight}else if($rootScope.billdata.customertype==appvariables.get("customertype")[0].retail){$rootScope.billdata.customercreditlimit=utilities.roundtodecimal(response[0][0].creditlimitcash);$rootScope.billdata.customeroutstanding=utilities.roundtodecimal(response[0][0].outstandingcash)}if($rootScope.billdata.customertype==appvariables.get("customertype")[0].goldsmith){$rootScope.issuedetail=[];$rootScope.returndetail=[];$rootScope.billdata.customeroutstanding=0;if(response[0][0]!=undefined){$rootScope.billdata.customeroutstanding=response[0][0].outstandingweight}var issuelist=filterfunction.filterarray($rootScope.transactiondetails,{transactiontype:appvariables.get("transactiontype")[0].issue});var returnlist=filterfunction.filterarray($rootScope.transactiondetails,{transactiontype:appvariables.get("transactiontype")[0].return});var transactiongroup=_.groupBy(issuelist,"createddatetime");var currenttransaction;var rowdata;var issuesummary,returnsummary;var transactionidlist=[];for(var key in transactiongroup){var issuedata={company:$rootScope.billdata.company,customer:$rootScope.billdata.customer,store:$rootScope.billdata.store,transactiondate:"",olggoldweight:0,oldgoldpurity:"",ct995goldweight:"",cashissued:0,metalrate:"",netweightissued:0,user:0,comments:""};currenttransaction=transactiongroup[key];for(var row in currenttransaction){rowdata=currenttransaction[row];if(issuedata.transactiondate==""){issuedata.transactiondate=utilities.date2Format(rowdata.transactiondate,"yyyy/mm/dd")}if(issuedata.user==""){issuedata.user=rowdata.loginuserfname}if(rowdata.product_code==appvariables.get("productcode")[0].oldgold){issuedata.olggoldweight=+issuedata.olggoldweight+ +rowdata.productvalue;issuedata.oldgoldpurity=rowdata.purity;transactionidlist.push(rowdata.transactionid)}else if(rowdata.product_code==appvariables.get("productcode")[0].cash){issuedata.cashissued=+issuedata.cashissued+ +rowdata.productvalue;issuedata.metalrate=rowdata.rate;transactionidlist.push(rowdata.transactionid)}else if(rowdata.product_code==appvariables.get("productcode")[0].gold){issuedata.ct995goldweight=+issuedata.ct995goldweight+ +rowdata.productvalue;transactionidlist.push(rowdata.transactionid)}}issuedata.netweightissued=0;if($rootScope.transactionbilldetails!=""||$rootScope.transactionbilldetails!=undefined){for(var tid in transactionidlist){var billweight;billweight=filterfunction.filterarray($rootScope.transactionbilldetails,{transactionid:transactionidlist[tid]});if(billweight[0].calculatedweight===""|billweight[0].calculatedweight==undefined){}else{issuedata.netweightissued=+issuedata.netweightissued+ +billweight[0].calculatedweight}}issuedata.netweightissued=utilities.roundtodecimal(issuedata.netweightissued,3)}$rootScope.issuedetail.push(issuedata)}transactiongroup=_.groupBy(returnlist,"transactionid");for(var key in transactiongroup){var returndata={company:$rootScope.billdata.company,customer:$rootScope.billdata.customer,store:$rootScope.billdata.store,transactiondate:"",item:0,category:"",quantity:"",weight:"",stoneweight:0,stonevalue:0,metalrate:"",valueaddition:0,wastage:0,purity:0,makingexpense:0,netweightreturned:"",user:""};var billweight=0;returndata.netweightreturned=0;if($rootScope.transactionbilldetails!=""||$rootScope.transactionbilldetails!=undefined){billweight=filterfunction.filterarray($rootScope.transactionbilldetails,{transactionid:key});returndata.netweightreturned=billweight[0].calculatedweight}currenttransaction=transactiongroup[key];for(var row in currenttransaction){rowdata=currenttransaction[row];if(returndata.transactiondate==""){returndata.transactiondate=utilities.date2Format(rowdata.transactiondate,"yyyy/mm/dd")}if(returndata.user==""){returndata.user=rowdata.loginuserfname}if(rowdata.product_code==appvariables.get("productcode")[0].gold){returndata.item=rowdata.package_name;returndata.category=rowdata.categoryname;returndata.metalrate=rowdata.rate;returndata.quantity=rowdata.quantity;returndata.weight=rowdata.productvalue;returndata.purity=rowdata.purity}else if(rowdata.product_code==appvariables.get("productcode")[0].makingexpense){returndata.makingexpense=rowdata.productvalue}else if(rowdata.product_code==appvariables.get("productcode")[0].valueaddition){returndata.valueaddition=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].stoneweight){returndata.stoneweight=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].stonevalue){returndata.stonevalue=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].wastage){returndata.wastage=rowdata.productvalue}if(currenttransaction[+row+ +1]==undefined){$rootScope.returndetail.push(returndata)}}}}}else if(response[0].result!="ERROR"){logger.logError("unable to load transactions. please contact support")}}else{logger.logWarning("no transaction available")}})};$scope.listtransactionfortype=function(){if($rootScope.billdata.customer==0){logger.logWarning("please select customer");return}servicesservice.listtransactionfortype($rootScope.billdata,function(response){if(response!=undefined){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){$rootScope.transactionsummary=response[0];$rootScope.transactiondetails=response[1];$rootScope.transactionbilldetails=response[2];$rootScope.transactiondetailsfordisplay=response[1];$rootScope.customertransactionsummary.totalsaleqty=0;$rootScope.customertransactionsummary.totalsaleweight=0;$rootScope.customertransactionsummary.totalpurchaseqty=0;$rootScope.customertransactionsummary.totalpurchaseweight=0;$rootScope.customertransactionsummary.totalcash=0;$rootScope.customertransactionsummary.totalsalesreturnqty=0;$rootScope.customertransactionsummary.totalsalesreturnweight=0;var currenttransaction;for(var key in $rootScope.transactiondetailsfordisplay){currenttransaction=$rootScope.transactiondetailsfordisplay[key];if(currenttransaction.transactiontype==appvariables.get("transactiontype")[0].sales&&currenttransaction.product_code==appvariables.get("productcode")[0].gold){$rootScope.customertransactionsummary.totalsaleqty+=currenttransaction.quantity;$rootScope.customertransactionsummary.totalsaleweight+=currenttransaction.productvalue}else if(currenttransaction.transactiontype==appvariables.get("transactiontype")[0].purchase&&currenttransaction.product_code==appvariables.get("productcode")[0].oldgold){$rootScope.customertransactionsummary.totalpurchaseqty+=currenttransaction.quantity;$rootScope.customertransactionsummary.totalpurchaseweight+=currenttransaction.productvalue}else if(currenttransaction.transactiontype==appvariables.get("transactiontype")[0].cashreceipt&&currenttransaction.product_code==appvariables.get("productcode")[0].cash){$rootScope.customertransactionsummary.totalcash+=currenttransaction.productvalue}else if(currenttransaction.transactiontype==appvariables.get("transactiontype")[0].salesreturn&&currenttransaction.product_code==appvariables.get("productcode")[0].gold){$rootScope.customertransactionsummary.totalsalesreturnqty+=currenttransaction.quantity;$rootScope.customertransactionsummary.totalsalesreturnweight+=currenttransaction.productvalue}}$rootScope.customertransactionsummary.totalsaleqty=utilities.roundtodecimal($rootScope.customertransactionsummary.totalsaleqty,0);$rootScope.customertransactionsummary.totalsaleweight=utilities.roundtodecimal($rootScope.customertransactionsummary.totalsaleweight,3);$rootScope.customertransactionsummary.totalpurchaseqty=utilities.roundtodecimal($rootScope.customertransactionsummary.totalpurchaseqty,0);$rootScope.customertransactionsummary.totalpurchaseweight=utilities.roundtodecimal($rootScope.customertransactionsummary.totalpurchaseweight,3);$rootScope.customertransactionsummary.totalcash=utilities.roundtodecimal($rootScope.customertransactionsummary.totalcash,2);$rootScope.customertransactionsummary.totalsalesreturnqty=utilities.roundtodecimal($rootScope.customertransactionsummary.totalsalesreturnqty,0);$rootScope.customertransactionsummary.totalsalesreturnweight=utilities.roundtodecimal($rootScope.customertransactionsummary.totalsalesreturnweight,3);if($rootScope.billdata.customertype==appvariables.get("customertype")[0].wholesale){$rootScope.billdata.customercreditlimit=response[0][0].creditlimitweight;$rootScope.billdata.customeroutstanding=response[0][0].outstandingweight}else if($rootScope.billdata.customertype==appvariables.get("customertype")[0].retail){$rootScope.billdata.customercreditlimit=utilities.roundtodecimal(response[0][0].creditlimitcash);$rootScope.billdata.customeroutstanding=utilities.roundtodecimal(response[0][0].outstandingcash)}if($rootScope.billdata.customertype==appvariables.get("customertype")[0].goldsmith){$rootScope.issuedetail=[];$rootScope.returndetail=[];$rootScope.billdata.customeroutstanding=0;if(response[0][0]!=undefined){$rootScope.billdata.customeroutstanding=response[0][0].outstandingweight}var issuelist=filterfunction.filterarray($rootScope.transactiondetails,{transactiontype:appvariables.get("transactiontype")[0].issue});var returnlist=filterfunction.filterarray($rootScope.transactiondetails,{transactiontype:appvariables.get("transactiontype")[0].return});var transactiongroup=_.groupBy(issuelist,"createddatetime");var currenttransaction;var rowdata;var issuesummary,returnsummary;var transactionidlist=[];for(var key in transactiongroup){var issuedata={company:$rootScope.billdata.company,customer:$rootScope.billdata.customer,store:$rootScope.billdata.store,transactiondate:"",olggoldweight:0,oldgoldpurity:"",ct995goldweight:"",cashissued:0,metalrate:"",netweightissued:0,user:0,comments:""};currenttransaction=transactiongroup[key];for(var row in currenttransaction){rowdata=currenttransaction[row];if(issuedata.transactiondate==""){issuedata.transactiondate=utilities.date2Format(rowdata.transactiondate,"yyyy/mm/dd")}if(issuedata.user==""){issuedata.user=rowdata.loginuserfname}if(rowdata.product_code==appvariables.get("productcode")[0].oldgold){issuedata.olggoldweight=+issuedata.olggoldweight+ +rowdata.productvalue;issuedata.oldgoldpurity=rowdata.purity;transactionidlist.push(rowdata.transactionid)}else if(rowdata.product_code==appvariables.get("productcode")[0].cash){issuedata.cashissued=+issuedata.cashissued+ +rowdata.productvalue;issuedata.metalrate=rowdata.rate;transactionidlist.push(rowdata.transactionid)}else if(rowdata.product_code==appvariables.get("productcode")[0].gold){issuedata.ct995goldweight=+issuedata.ct995goldweight+ +rowdata.productvalue;transactionidlist.push(rowdata.transactionid)}}issuedata.netweightissued=0;if($rootScope.transactionbilldetails!=""||$rootScope.transactionbilldetails!=undefined){for(var tid in transactionidlist){var billweight;billweight=filterfunction.filterarray($rootScope.transactionbilldetails,{transactionid:transactionidlist[tid]});if(billweight[0].calculatedweight===""|billweight[0].calculatedweight==undefined){}else{issuedata.netweightissued=+issuedata.netweightissued+ +billweight[0].calculatedweight}}issuedata.netweightissued=utilities.roundtodecimal(issuedata.netweightissued,3)}$rootScope.issuedetail.push(issuedata)}transactiongroup=_.groupBy(returnlist,"transactionid");for(var key in transactiongroup){var returndata={company:$rootScope.billdata.company,customer:$rootScope.billdata.customer,store:$rootScope.billdata.store,transactiondate:"",item:0,category:"",quantity:"",weight:"",stoneweight:0,stonevalue:0,metalrate:"",valueaddition:0,wastage:0,purity:0,makingexpense:0,netweightreturned:"",user:""};var billweight=0;returndata.netweightreturned=0;if($rootScope.transactionbilldetails!=""||$rootScope.transactionbilldetails!=undefined){billweight=filterfunction.filterarray($rootScope.transactionbilldetails,{transactionid:key});returndata.netweightreturned=billweight[0].calculatedweight}currenttransaction=transactiongroup[key];for(var row in currenttransaction){rowdata=currenttransaction[row];if(returndata.transactiondate==""){returndata.transactiondate=utilities.date2Format(rowdata.transactiondate,"yyyy/mm/dd")}if(returndata.user==""){returndata.user=rowdata.loginuserfname}if(rowdata.product_code==appvariables.get("productcode")[0].gold){returndata.item=rowdata.package_name;returndata.category=rowdata.categoryname;returndata.metalrate=rowdata.rate;returndata.quantity=rowdata.quantity;returndata.weight=rowdata.productvalue;returndata.purity=rowdata.purity
}else if(rowdata.product_code==appvariables.get("productcode")[0].makingexpense){returndata.makingexpense=rowdata.productvalue}else if(rowdata.product_code==appvariables.get("productcode")[0].valueaddition){returndata.valueaddition=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].stoneweight){returndata.stoneweight=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].stonevalue){returndata.stonevalue=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].wastage){returndata.wastage=rowdata.productvalue}if(currenttransaction[+row+ +1]==undefined){$rootScope.returndetail.push(returndata)}}}}}else if(response[0].result!="ERROR"){logger.logError("unable to load transactions. please contact support")}}else{logger.logWarning("no transaction available")}})};$scope.filltransactionsupplementarydetails=function(tid){$rootScope.billdata.makingexpense=0;$rootScope.billdata.makingcharge=0;$rootScope.billdata.valueaddition=0;$rootScope.billdata.stoneweight=0;$rootScope.billdata.stonevalue=0;if($rootScope.billdata.customer==0){logger.logWarning("please select customer");return}if($rootScope.transactiondetails.length==0){$scope.listtransaction()}if($rootScope.transactiondetails.length==0){logger.logWarning("no transaction for selected customer.");return}$scope.filteredtransactioncharges=filterfunction.filterarray($rootScope.transactiondetails,{transactionid:tid});var transactiongroup=_.groupBy($scope.filteredtransactioncharges,"transactionid");var currenttransaction;var rowdata;for(var key in transactiongroup){currenttransaction=transactiongroup[key];for(var row in currenttransaction){rowdata=currenttransaction[row];$rootScope.billdata.package=rowdata.package;$rootScope.billdata.packagecode=rowdata.packagecode;$rootScope.billdata.packagename=rowdata.package_name;if(rowdata.transactiontype==appvariables.get("transactiontype")[0].sales){$rootScope.billdata.transactiontype=appvariables.get("transactiontype")[0].sales;if(rowdata.product_code==appvariables.get("productcode")[0].gold){$rootScope.billdata.category=rowdata.category;$rootScope.billdata.metalrate=rowdata.rate;$rootScope.billdata.quantity=rowdata.quantity;$rootScope.billdata.weight=rowdata.productvalue;$rootScope.billdata.purity=rowdata.purity}else if(rowdata.product_code==appvariables.get("productcode")[0].makingexpense){$rootScope.billdata.makingexpense=rowdata.productvalue}else if(rowdata.product_code==appvariables.get("productcode")[0].makingcharge){$rootScope.billdata.makingcharge=rowdata.productvalue}else if(rowdata.product_code==appvariables.get("productcode")[0].valueaddition){$rootScope.billdata.valueaddition=rowdata.productvalue}else if(rowdata.product_code==appvariables.get("productcode")[0].stoneweight){$rootScope.billdata.stoneweight=rowdata.productvalue}else if(rowdata.product_code==appvariables.get("productcode")[0].stonevalue){$rootScope.billdata.stonevalue=rowdata.productvalue}else if(rowdata.product_code==appvariables.get("productcode")[0].wastage){$rootScope.billdata.wastage=rowdata.productvalue}}if(rowdata.transactiontype==appvariables.get("transactiontype")[0].purchase){$rootScope.billdata.transactiontype=appvariables.get("transactiontype")[0].purchase;if(rowdata.product_code==appvariables.get("productcode")[0].oldgold){$rootScope.billdata.category=rowdata.category;$rootScope.billdata.metalrate=rowdata.rate;$rootScope.billdata.quantity=rowdata.quantity;$rootScope.billdata.weight=rowdata.productvalue;$rootScope.billdata.purity=rowdata.purity}else if(rowdata.product_code==appvariables.get("productcode")[0].testweight){$rootScope.billdata.testweight=rowdata.productvalue}else if(rowdata.product_code==appvariables.get("productcode")[0].testreturn){$rootScope.billdata.testreturnweight=rowdata.productvalue}else if(rowdata.product_code==appvariables.get("productcode")[0].testpurity){$rootScope.billdata.testpurity=rowdata.purity}else if(rowdata.product_code==appvariables.get("productcode")[0].puregold){$rootScope.billdata.puregoldweight=rowdata.productvalue}}if(rowdata.transactiontype==appvariables.get("transactiontype")[0].cashreceipt){$rootScope.billdata.transactiontype=appvariables.get("transactiontype")[0].cashreceipt;if(rowdata.product_code==appvariables.get("productcode")[0].cashreceipt){$rootScope.billdata.category=rowdata.category;$rootScope.billdata.metalrate=rowdata.rate;$rootScope.billdata.quantity=rowdata.quantity;$rootScope.billdata.cashreceived=rowdata.productvalue}}if(rowdata.transactiontype==appvariables.get("transactiontype")[0].salesreturn){$rootScope.billdata.transactiontype=appvariables.get("transactiontype")[0].salesreturn;if(rowdata.product_code==appvariables.get("productcode")[0].gold){$rootScope.billdata.category=rowdata.category;$rootScope.billdata.metalrate=rowdata.rate;$rootScope.billdata.quantity=rowdata.quantity;$rootScope.billdata.weight=rowdata.productvalue;$rootScope.billdata.purity=rowdata.purity}else if(rowdata.product_code==appvariables.get("productcode")[0].makingexpense){$rootScope.billdata.makingexpense=rowdata.productvalue}else if(rowdata.product_code==appvariables.get("productcode")[0].makingcharge){$rootScope.billdata.makingcharge=rowdata.productvalue}else if(rowdata.product_code==appvariables.get("productcode")[0].valueaddition){$rootScope.billdata.valueaddition=rowdata.productvalue}else if(rowdata.product_code==appvariables.get("productcode")[0].stoneweight){$rootScope.billdata.stoneweight=rowdata.productvalue}else if(rowdata.product_code==appvariables.get("productcode")[0].stonevalue){$rootScope.billdata.stonevalue=rowdata.productvalue}else if(rowdata.product_code==appvariables.get("productcode")[0].wastage){$rootScope.billdata.wastage=rowdata.productvalue}}}}};$scope.filterlisttransactionforbill=function(rowdata){$rootScope.billdata.makingexpense=0;$rootScope.billdata.makingcharge=0;$rootScope.billdata.valueaddition=0;$rootScope.billdata.stoneweight=0;$rootScope.billdata.stonevalue=0;$rootScope.billdata.transactionid=rowdata.transactionid;$rootScope.billdata.transactiondate=utilities.date2Format(rowdata.transactiondate,"yyyy/mm/dd");if($rootScope.billdata.transactionid==0||$rootScope.billdata.transactionid==undefined){logger.logWarning("please select transaction item.")}else{$rootScope.listtransactioncharges=filterfunction.filterarray($rootScope.transactiondetails,{transactionid:rowdata.transactionid});$scope.filltransactionsupplementarydetails(rowdata.transactionid)}};$scope.filtergoldsmithtransaction=function(gstransactionlist){$rootScope.issuedetail=[];$rootScope.returndetail=[];var issuelist=filterfunction.filterarray(gstransactionlist,{transactiontype:appvariables.get("transactiontype")[0].issue});var returnlist=filterfunction.filterarray($rootScope.transactiondetails,{transactiontype:appvariables.get("transactiontype")[0].return});var transactiongroup=_.groupBy(issuelist,"transactiondate");var currenttransaction;var rowdata;var issuesummary,returnsummary;var issuedata={company:$rootScope.billdata.company,customer:$rootScope.billdata.customer,store:$rootScope.billdata.store,transactiondate:"",olggoldweight:0,oldgoldpurity:"",ct995goldweight:"",cashissued:0,metalrate:"",netweightissued:0,user:0,comments:""};var transactionidlist=[];for(var key in transactiongroup){currenttransaction=transactiongroup[key];for(var row in currenttransaction){rowdata=currenttransaction[row];if(issuedata.transactiondate==""){issuedata.transactiondate=utilities.date2Format(rowdata.transactiondate,"yyyy/mm/dd")}if(issuedata.user==""){issuedata.user=rowdata.loginuserfname}if(rowdata.product_code==appvariables.get("productcode")[0].oldgold){issuedata.olggoldweight=+issuedata.olggoldweight+ +rowdata.productvalue;issuedata.oldgoldpurity=rowdata.purity;transactionidlist.push(rowdata.transactionid)}else if(rowdata.product_code==appvariables.get("productcode")[0].cash){issuedata.cashissued=+issuedata.cashissued+ +rowdata.productvalue;issuedata.metalrate=rowdata.rate;transactionidlist.push(rowdata.transactionid)}else if(rowdata.product_code==appvariables.get("productcode")[0].gold){issuedata.ct995goldweight=+issuedata.ct995goldweight+ +rowdata.productvalue;transactionidlist.push(rowdata.transactionid)}}issuedata.netweightissued=0;if($rootScope.transactionbilldetails!=""||$rootScope.transactionbilldetails!=undefined){for(var tid in transactionidlist){var billweight;billweight=filterfunction.filterarray($rootScope.transactionbilldetails,{transactionid:transactionidlist[tid]});if(billweight[0].calculatedweight===""|billweight[0].calculatedweight==undefined){}else{issuedata.netweightissued=+issuedata.netweightissued+ +billweight[0].calculatedweight}}issuedata.netweightissued=utilities.roundtodecimal(issuedata.netweightissued,3)}$rootScope.issuedetail.push(issuedata)}transactiongroup=_.groupBy(returnlist,"transactionid");for(var key in transactiongroup){var returndata={company:$rootScope.billdata.company,customer:$rootScope.billdata.customer,store:$rootScope.billdata.store,transactiondate:"",item:0,category:"",quantity:"",weight:"",stoneweight:0,stonevalue:0,metalrate:"",valueaddition:0,wastage:0,purity:0,makingexpense:0,netweightreturned:"",user:""};var billweight=0;returndata.netweightreturned=0;if($rootScope.transactionbilldetails!=""||$rootScope.transactionbilldetails!=undefined){billweight=filterfunction.filterarray($rootScope.transactionbilldetails,{transactionid:key});returndata.netweightreturned=billweight[0].calculatedweight}currenttransaction=transactiongroup[key];for(var row in currenttransaction){rowdata=currenttransaction[row];if(returndata.transactiondate==""){returndata.transactiondate=utilities.date2Format(rowdata.transactiondate,"yyyy/mm/dd")}if(returndata.user==""){returndata.user=rowdata.loginuserfname}if(rowdata.product_code==appvariables.get("productcode")[0].gold){returndata.item=rowdata.package_name;returndata.category=rowdata.categoryname;returndata.metalrate=rowdata.rate;returndata.quantity=rowdata.quantity;returndata.weight=rowdata.productvalue;returndata.purity=rowdata.purity}else if(rowdata.product_code==appvariables.get("productcode")[0].makingexpense){returndata.makingexpense=rowdata.productvalue}else if(rowdata.product_code==appvariables.get("productcode")[0].valueaddition){returndata.valueaddition=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].stoneweight){returndata.stoneweight=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].stonevalue){returndata.stonevalue=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].wastage){returndata.wastage=rowdata.productvalue}if(currenttransaction[+row+ +1]==undefined){$rootScope.returndetail.push(returndata)}}}};$scope.excludetransactionfrombill=function(event,rowdata){if(rowdata!=undefined){for(var key in $rootScope.transactionalcharges){if($rootScope.transactionalcharges[key].transactionid==rowdata.transactionid){$rootScope.transactionalcharges[key].excludetransaction=event.currentTarget.value}}}};$scope.listbillcharges=function(){var billcharges=[];$rootScope.transactionalcharges="";if($rootScope.billdata.customer==0){logger.logWarning("please select customer");return}if($rootScope.transactiondetails.length==0){$scope.listtransaction()}if($rootScope.transactiondetails.length==0){logger.logWarning("no transaction for selected customer.");return}var transactiongroup=_.groupBy($rootScope.transactiondetails,"transactionid");var currenttransaction;var rowdata;for(var key in transactiongroup){var billchargedata={company:$rootScope.billdata.company,customer:$rootScope.billdata.customer,store:$rootScope.billdata.store,"package":0,packagecode:"",packagename:"",product:0,productcode:"",category:0,metalrate:0,quantity:0,weight:0,purity:0,transactionid:0,transactiondate:"",transactiontype:0,customertype:$rootScope.billdata.customertype,customeroutstandingtype:$rootScope.billdata.customeroutstandingtype,wastage:"-",makingexpense:"-",makingcharge:"-",valueaddition:"-",stoneweight:"-",stonevalue:"-",user:$rootScope.loggedinuser,comments:"bill charges",updatesummary:0,excludetransaction:0,purchaseweight:0,testweight:0,testreturnweight:0,puregoldweight:0,cashreceived:0};currenttransaction=transactiongroup[key];for(var row in currenttransaction){rowdata=currenttransaction[row];if(billchargedata.customer==0){billchargedata.customer=rowdata.customer}if(billchargedata.transactionid==0){billchargedata.transactionid=rowdata.transactionid}if(billchargedata.transactiondate==""){billchargedata.transactiondate=utilities.date2Format(rowdata.transactiondate,"yyyy/mm/dd")}if(billchargedata.package==0){billchargedata.package=rowdata.package}if(billchargedata.packagename==0){billchargedata.packagename=rowdata.package_name}if(billchargedata.packagecode==0){billchargedata.packagecode=rowdata.packagecode}if(rowdata.transactiontype==appvariables.get("transactiontype")[0].sales){billchargedata.transactiontype=appvariables.get("transactiontype")[0].sales;if(rowdata.product_code==appvariables.get("productcode")[0].gold){billchargedata.category=rowdata.category;billchargedata.metalrate=rowdata.rate;billchargedata.quantity=rowdata.quantity;billchargedata.weight=rowdata.productvalue;billchargedata.purity=rowdata.purity}if(rowdata.product_code==appvariables.get("productcode")[0].makingexpense){billchargedata.makingexpense=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].makingcharge){billchargedata.makingcharge=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].valueaddition){billchargedata.valueaddition=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].stoneweight){billchargedata.stoneweight=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].stonevalue){billchargedata.stonevalue=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].wastage){billchargedata.wastage=rowdata.productvalue}}if(rowdata.transactiontype==appvariables.get("transactiontype")[0].purchase){billchargedata.transactiontype=appvariables.get("transactiontype")[0].purchase;if(rowdata.product_code==appvariables.get("productcode")[0].oldgold|rowdata.product_code==appvariables.get("productcode")[0].gold){billchargedata.category=rowdata.category;billchargedata.metalrate=rowdata.rate;billchargedata.quantity=rowdata.quantity;billchargedata.weight=rowdata.productvalue;billchargedata.purity=rowdata.purity}if(rowdata.product_code==appvariables.get("productcode")[0].testweight){billchargedata.testweight=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].testreturn){billchargedata.testreturnweight=rowdata.productvalue}}if(rowdata.transactiontype==appvariables.get("transactiontype")[0].cashreceipt){billchargedata.transactiontype=appvariables.get("transactiontype")[0].cashreceipt;if(rowdata.product_code==appvariables.get("productcode")[0].cash){billchargedata.category=rowdata.category;billchargedata.metalrate=rowdata.rate;billchargedata.quantity=rowdata.quantity;billchargedata.weight=rowdata.productvalue}}if(rowdata.transactiontype==appvariables.get("transactiontype")[0].salesreturn){billchargedata.transactiontype=appvariables.get("transactiontype")[0].salesreturn;if(rowdata.product_code==appvariables.get("productcode")[0].gold){billchargedata.category=rowdata.category;billchargedata.metalrate=rowdata.rate;billchargedata.quantity=rowdata.quantity;billchargedata.weight=rowdata.productvalue;billchargedata.purity=rowdata.purity}if(rowdata.product_code==appvariables.get("productcode")[0].makingexpense){billchargedata.makingexpense=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].makingcharge){billchargedata.makingcharge=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].valueaddition){billchargedata.valueaddition=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].stoneweight){billchargedata.stoneweight=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].stonevalue){billchargedata.stonevalue=rowdata.productvalue}if(rowdata.product_code==appvariables.get("productcode")[0].wastage){billchargedata.wastage=rowdata.productvalue}}if(currenttransaction[+row+ +1]==undefined){billcharges.push(billchargedata)}}}$rootScope.transactionalcharges=billcharges};$scope.listhistory=function(transaction){var formdata=$rootScope.billdata;$rootScope.billdata.transactionid=transaction.transactionid;if($rootScope.billdata.customer==undefined||$rootScope.billdata.customer==0){logger.logWarning("please select customer.");return}else{servicesservice.listhistory(formdata,function(responsedata){if(responsedata!=undefined){$rootScope.transactionhistoryheader=responsedata[0];$rootScope.transactionhistorybody=responsedata[1];ngDialog.open({template:"modelhistory",className:"ngdialog-theme-default custom-width",closeByDocument:false})}else{logger.logError("transaction history not available.")}})}};$scope.onchangecustomer=function(billcustomer){$rootScope.issuedetail=[];$rootScope.returndetail=[];$scope.closepanel();if(billcustomer!=null){$rootScope.billdata.customer=billcustomer.customerid;$rootScope.billdata.customername=billcustomer.orgname;$rootScope.billdata.customeroutstandingtype=billcustomer.outstandingtype;if(billcustomer.customertype==appvariables.get("customertype")[0].wholesale||billcustomer.customertype==appvariables.get("customertype")[0].goldsmith||billcustomer.customertype==appvariables.get("customertype")[0].self){$rootScope.billdata.metalrate=appvariables.get("wholesalerate")}else{$rootScope.billdata.metalrate=appvariables.get("retailrate")}$scope.listtransaction()}else{$rootScope.billdata.customer=0;$rootScope.billdata.package=0;$rootScope.billdata.packagecode="";$rootScope.billdata.product=0;$rootScope.billdata.productcode="";$rootScope.billdata.category=0;$rootScope.billdata.quantity=0;$rootScope.billdata.weight=0;$rootScope.billdata.purity=0;$rootScope.billdata.transactionid=0;$rootScope.billdata.comments=""}};$scope.onchangeitem=function(billpackage){if(billpackage!=null){$rootScope.billdata.purity=billpackage.purity;$rootScope.billdata.package=billpackage.packages_id;$rootScope.billdata.product=billpackage.productid;$rootScope.billdata.packagecode=billpackage.packages_code;$rootScope.billdata.productcode=billpackage.productcode;$rootScope.editbilldata.newpurity=billpackage.purity;$rootScope.editbilldata.newpackage=billpackage.packages_id;$rootScope.editbilldata.newproduct=billpackage.productid;$rootScope.editbilldata.newpackagecode=billpackage.packages_code;$rootScope.editbilldata.newproductcode=billpackage.productcode;$rootScope.billdata.store=appvariables.get("storetype")[0].display}else{$rootScope.billdata.package=0;$rootScope.billdata.packagecode="";$rootScope.billdata.product=0;$rootScope.billdata.productcode="";$rootScope.billdata.category=0;$rootScope.billdata.quantity=0;$rootScope.billdata.weight=0;$rootScope.billdata.purity=0;$rootScope.billdata.transactionid=0;$rootScope.billdata.comments=""}};$scope.onchangecategoryitem=function(stockpackage){if(stockpackage!=null){$rootScope.stockdata.package=stockpackage.packages_id}};$scope.onchangecategory=function(billcategory){if(billcategory!=null){$rootScope.billdata.category=billcategory.categoryid;$rootScope.editbilldata.newcategory=billcategory.categoryid}};$scope.onchangetransactiontype=function(selectedtabcontrol){$scope.closepanel();$rootScope.selectedtabcontrol=selectedtabcontrol;$rootScope.disablepurity=true;$scope.expenselist=false;$scope.cashflow=false;$scope.cashflowexpense=false;if(selectedtabcontrol=="cash"){$scope.cashflow=true}if($rootScope.billdata.customertype==appvariables.get("customertype")[0].self){$scope.calculation=false;$scope.cashflow=true;$scope.cashflowexpense=true;if(selectedtabcontrol=="sales"|selectedtabcontrol=="sales return"|selectedtabcontrol=="pre-bill"){logger.logWarning("transaction not valid for selected customer type.");$scope.collapsepanel=false;$scope.collapsebill=false;$rootScope.calculatedamount=0;return}else{$rootScope.billdata.customer=$scope.billcustomer.customerid;$rootScope.billdata.valueaddition=0;$rootScope.calculatedamount=0;if(selectedtabcontrol=="cash"){$scope.expenselist=true}}}$scope.selectedtab=selectedtabcontrol;$scope.collapsepanel=false;$scope.collapsebill=false;$rootScope.calculatedamount=0;if(selectedtabcontrol=="sales"|selectedtabcontrol=="sales return"){$rootScope.billdata.productcode=appvariables.get("addonproductcode")[0].metal;$scope.listpackage=filterfunction.getpackagenames(appvariables.get("packagecode")[0].ornamentgold);$scope.listpackage=filterfunction.filterarray($scope.listpackage,{productcode:$rootScope.billdata.productcode});if(selectedtabcontrol=="sales"){$rootScope.billdata.transactiontype=appvariables.get("transactiontype")[0].sales;$rootScope.billdata.store=appvariables.get("storetype")[0].display;$rootScope.billdata.comments="approval "}else if(selectedtabcontrol=="sales return"){$rootScope.billdata.transactiontype=appvariables.get("transactiontype")[0].salesreturn;$rootScope.billdata.store=appvariables.get("storetype")[0].godown;$rootScope.billdata.comments="sales return "}$scope.collapsepanel=true;$scope.item=true;$scope.quantity=true;$scope.weight=true;$scope.rates=true;$scope.purity=true;$scope.category=true;$scope.comments=true;$scope.hidebutton=true;$scope.showsalesdetails=false;$scope.showpurchasedetails=false;$scope.amount=false;$scope.quantitylabel=true;$scope.weightlabel=true;$scope.approvals=true;$scope.calculation=false;$rootScope.billdata.updatesummary=1}else if(selectedtabcontrol=="purchase"){$rootScope.billdata.comments="old gold purchase ";$rootScope.billdata.productcode=appvariables.get("addonproductcode")[0].oldgold;$rootScope.billdata.selecteditemunit="gm";$scope.listpackage=filterfunction.getpackagenames(appvariables.get("packagecode")[0].oldgold);$scope.listpackage=filterfunction.filterarray($scope.listpackage,{productcode:$rootScope.billdata.productcode});$rootScope.billdata.productcode=appvariables.get("addonproductcode")[0].metal;var billingpurchasepackagelist=filterfunction.getpackagenames(appvariables.get("packagecode")[0].gold995);billingpurchasepackagelist=filterfunction.filterarray(billingpurchasepackagelist,{productcode:$rootScope.billdata.productcode});$scope.listpackage=$scope.listpackage.concat(billingpurchasepackagelist);$rootScope.billdata.transactiontype=appvariables.get("transactiontype")[0].purchase;$rootScope.billdata.rate=appvariables.get("wholesalerate");$rootScope.billdata.store=appvariables.get("storetype")[0].godown;$rootScope.billdata.quantity=1;$scope.collapsepanel=true;$scope.item=true;$scope.quantity=false;$scope.quantitylabel=false;$scope.weightlabel=true;$scope.weight=true;$scope.rates=true;$scope.purity=true;$scope.category=false;$scope.comments=true;$scope.hidebutton=true;$scope.showsalesdetails=false;$scope.showpurchasedetails=false;$scope.amount=false;$rootScope.disablepurity=false;$scope.calculation=true;if($rootScope.billdata.customertype==appvariables.get("customertype")[0].self){$scope.calculation=true}$rootScope.billdata.updatesummary=1}else if(selectedtabcontrol=="cash"){$rootScope.billdata.productcode=appvariables.get("addonproductcode")[0].cash;$rootScope.billdata.comments="cash received from ";$rootScope.billdata.transactiontype=appvariables.get("transactiontype")[0].cashreceipt;$rootScope.billdata.selecteditemunit="rs";$scope.listpackage=filterfunction.getpackagenames(appvariables.get("packagecode")[0].cash);$scope.listpackage=filterfunction.filterarray($scope.listpackage,{productcode:appvariables.get("addonproductcode")[0].cash});if($scope.listpackage.length>0){$scope.billpackage=$scope.listpackage[0];$rootScope.billdata.package=$scope.billpackage.packages_id}$rootScope.billdata.store=appvariables.get("storetype")[0].godown;$rootScope.billdata.quantity=1;$rootScope.billdata.purity=1;$rootScope.billdata.rate=1;$scope.collapsepanel=true;$scope.item=true;$scope.quantitylabel=false;$scope.quantity=false;$scope.weight=true;$scope.rates=false;$scope.purity=false;$scope.category=false;$scope.comments=true;$scope.hidebutton=true;$scope.showsalesdetails=false;$scope.showpurchasedetails=false;$scope.amount=true;$scope.weightlabel=false;$scope.approvals=false;$scope.cashtransactiontype=$rootScope.billdata.transactiontype;if($rootScope.billdata.customertype==appvariables.get("customertype")[0].self){$scope.calculation=false}else{$scope.calculation=true}$rootScope.billdata.updatesummary=1}else if(selectedtabcontrol=="pre-bill"){$rootScope.billdata.store=appvariables.get("storetype")[0].display;$scope.collapsepanel=false;$scope.collapsebill=true;$scope.showreturn=false;$scope.showcash=false;$scope.showbill=true;$scope.hidebutton=false;$scope.amount=false;$scope.quantitylabel=true;$scope.showsalesdetails=false;$scope.showpurchasedetails=false;$scope.approvals=false;$scope.showreturn=false;$scope.showbill=true;$scope.showcash=false;$scope.calculation=false;$scope.listbillcharges();$rootScope.billdata.updatesummary=1}$scope.listtransaction()};$scope.cashflowchange=function(cashflowtype){if(cashflowtype==8){$rootScope.billdata.productcode=appvariables.get("addonproductcode")[0].cash;$rootScope.billdata.transactiontype=appvariables.get("transactiontype")[0].cashreceipt;$rootScope.billdata.comments="cash received from ";$scope.listpackage=filterfunction.getpackagenames(appvariables.get("packagecode")[0].cash);$scope.listpackage=filterfunction.filterarray($scope.listpackage,{productcode:appvariables.get("addonproductcode")[0].cash});if($scope.listpackage.length>0){$scope.billpackage=$scope.listpackage[0];$scope.onchangeitem($scope.billpackage)}$rootScope.billdata.store=appvariables.get("storetype")[0].godown;$rootScope.billdata.quantity=1;$rootScope.billdata.purity=1;$rootScope.billdata.rate=1}else{$rootScope.billdata.productcode=appvariables.get("addonproductcode")[0].cash;$rootScope.billdata.transactiontype=appvariables.get("transactiontype")[0].cashpayment;$rootScope.billdata.comments="cash paid to ";$scope.listpackage=filterfunction.getpackagenames(appvariables.get("packagecode")[0].cash);$scope.listpackage=filterfunction.filterarray($scope.listpackage,{productcode:appvariables.get("addonproductcode")[0].cash});if($scope.listpackage.length>0){$scope.billpackage=$scope.listpackage[0];$scope.onchangeitem($scope.billpackage)}$rootScope.billdata.store=appvariables.get("storetype")[0].godown;$rootScope.billdata.quantity=1;$rootScope.billdata.purity=1;$rootScope.billdata.rate=1}$scope.cashtransactiontype=$rootScope.billdata.transactiontype};$scope.validateinput=function(){var validationsuccess=true;var verifycustomer=true,verifypackage=true,verifycategory=true,verifypurity=true,verifyquantity=true,verifyweight=true,verifycomments=true,verifyoutstanding=true;switch(+$rootScope.billdata.transactiontype){case 1:break;case 2:verifycategory=false;verifycomments=false;verifyoutstanding=false;verifypurity=false;break;case 3:verifycomments=false;verifyoutstanding=false;break;case 4:verifycategory=false;verifyquantity=false;verifycomments=false;verifyoutstanding=false;break;case 5:verifycategory=false;verifyquantity=false;verifycomments=false;verifypackage=false;verifypurity=false;verifyweight=false;break;case 6:verifycomments=false;verifyoutstanding=false;break;case 7:verifycategory=false;verifypurity=false;verifyquantity=false;verifycomments=false;verifyoutstanding=false;break;case 8:verifycategory=false;verifypurity=false;verifyquantity=false;verifycomments=false;verifyoutstanding=false;break;case 9:verifycustomer=false;verifyoutstanding=false;break;default:logger.logWarning("invalid transaction type. aborting save");return}if($rootScope.billdata.customer==0&&verifycustomer){logger.logWarning("please select customer");validationsuccess=false}else if($rootScope.billdata.package==0&&verifypackage){logger.logWarning("please select item");validationsuccess=false}else if($rootScope.billdata.category==0&&verifycategory){logger.logWarning("please select category");validationsuccess=false}else if(($rootScope.billdata.purity==0||isNaN($rootScope.billdata.purity))&&verifypurity){logger.logWarning("invalid purity");validationsuccess=false}else if(isNaN($rootScope.billdata.quantity)&&verifyquantity){logger.logWarning("invalid quantity");validationsuccess=false;if(+$rootScope.billdata.quantity<+0){logger.logWarning("quantity cannot be negative")}}else if(($rootScope.billdata.weight==0||isNaN($rootScope.billdata.weight))&&verifyweight){logger.logWarning("invalid metal weight or value");validationsuccess=false}if($rootScope.billdata.comments==""&&verifycomments){logger.logWarning("please enter order description");validationsuccess=false}return validationsuccess};$scope.savereturn=function(row){$rootScope.billdata.transactionid=row.transactionid;$rootScope.billdata.transactiontype=row.transactiontype;$rootScope.billdata.package=row.packageid;$rootScope.billdata.quantity=-+$rootScope.billdata.returnquantity;$rootScope.billdata.weight=-+$rootScope.billdata.returnproductvalue;$rootScope.billdata.category=row.category;$rootScope.billdata.product=row.productid;$rootScope.billdata.rate=row.rate;$rootScope.billdata.purity=row.purity;$rootScope.billdata.comments="approval return";$rootScope.billdata.updatesummary=1;this.savetransaction()};$scope.savetransaction=function(){$rootScope.billdata.duedate=utilities.date2Format($rootScope.billdata.duedate,"yyyy/mm/dd");$rootScope.billdata.transactiondate=utilities.date2Format($rootScope.billdata.transactiondate,"yyyy/mm/dd");if($rootScope.billdata.quantity==undefined){$rootScope.billdata.quantity=1}if($rootScope.billdata.transactionid==undefined){$rootScope.billdata.transactionid=0}if($rootScope.billdata.transactiontype==appvariables.get("transactiontype")[0].cashreceipt){$rootScope.billdata.cashreceived=$rootScope.billdata.weight}else{$rootScope.billdata.cashreceived=0}var row;if($rootScope.billdata.valueaddition==0){for(var key in $rootScope.listallvalueaddition){row=$rootScope.listallvalueaddition[key];if(+row.customertype==+$rootScope.billdata.customertype&&+row.packageid==+$rootScope.billdata.package&&+$rootScope.billdata.weight>=+row.minvalue&&+$rootScope.billdata.weight<=+row.maxvalue){$rootScope.billdata.valueaddition=row.va;break}}}if($scope.validateinput()){var datapkgdetails=[];datapkgdetails.push({storeid:$rootScope.billdata.store,"package":$rootScope.billdata.package,packagecode:$rootScope.billdata.packagecode,product:$rootScope.billdata.product,productcode:$rootScope.billdata.productcode,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:$rootScope.billdata.quantity,weight:$rootScope.billdata.weight,purity:$rootScope.billdata.purity});if($rootScope.billdata.valueaddition>0){datapkgdetails.push({storeid:$rootScope.billdata.store,"package":$rootScope.billdata.package,packagecode:$rootScope.billdata.packagecode,product:$rootScope.billdata.product,productcode:appvariables.get("productcode")[0].valueaddition,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:"1",weight:$rootScope.billdata.valueaddition,purity:$rootScope.billdata.purity})}var pkgdata={data:datapkgdetails};var x2js=new X2JS;var transactionData="<root>"+x2js.json2xml_str(pkgdata)+"</root>";$rootScope.billdata.transactiondetail=transactionData;servicesservice.savetransaction($rootScope.billdata,function(response){if(response!=undefined){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){$("#btnsales").focus();if($rootScope.billdata.transactiontype==appvariables.get("transactiontype")[0].purchase&&$rootScope.billdata.customertype==appvariables.get("customertype")[0].self){var listcashpackage=filterfunction.getpackagenames(appvariables.get("packagecode")[0].cash);var basepurity=appvariables.get("basepuritypercentage");var retailrate=appvariables.get("retailrate");var wholesalerate=appvariables.get("wholesalerate");var calculatedpurchasedweight=utilities.roundtodecimal(+$rootScope.billdata.weight*+$rootScope.billdata.purity/+basepurity,3);
var cashtobepaidagainstpurchase=calculatedpurchasedweight*retailrate;$rootScope.billdata.transactiontype=appvariables.get("transactiontype")[0].cashpayment;$rootScope.billdata.quantity=1;$rootScope.billdata.weight=cashtobepaidagainstpurchase;var cashdatapkgdetails=[];cashdatapkgdetails.push({storeid:$rootScope.billdata.store,"package":listcashpackage[0].packages_id,packagecode:appvariables.get("packagecode")[0].cash,product:0,productcode:appvariables.get("productcode")[0].cash,category:0,price:$rootScope.billdata.metalrate,quantity:"1",weight:$rootScope.billdata.weight,purity:basepurity});var cashpkgdata={data:cashdatapkgdetails};var x2js=new X2JS;var cashtransactionData="<root>"+x2js.json2xml_str(cashpkgdata)+"</root>";$rootScope.billdata.transactiondetail=cashtransactionData;servicesservice.savetransaction($rootScope.billdata,function(response){if(response!=undefined){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){logger.logSuccess("transaction saved.");$scope.closepanel();$scope.listtransaction();$scope.clearbilldata()}}})}else{logger.logSuccess("transaction saved.");$scope.closepanel();$scope.listtransaction();$scope.clearbilldata()}if($rootScope.billdata.transactiontype==appvariables.get("transactiontype")[0].order){$scope.listorder()}}else{logger.logError("unable to save transaction. please contact support.")}}else{logger.logWarning("transaction not added.")}})}};$scope.savebillcharges=function(rowdata){$rootScope.billdata.transactionid=rowdata.transactionid;$rootScope.billdata.transactiontype=rowdata.transactiontype;$rootScope.billdata.package=rowdata.packageid;$rootScope.billdata.packagecode=rowdata.packagecode;$rootScope.billdata.product=rowdata.productid;$rootScope.billdata.productcode=rowdata.product_code;$rootScope.billdata.category=rowdata.category;$rootScope.billdata.quantity=0;$rootScope.billdata.rate=rowdata.rate;$rootScope.billdata.purity=rowdata.purity;$rootScope.billdata.updatesummary=1;$rootScope.billdata.comments="transaction bill charges";var datapkgdetails=[];datapkgdetails.splice(0,datapkgdetails.length);datapkgdetails.push({storeid:rowdata.storeid,"package":rowdata.packageid,packagecode:rowdata.packages_code,product:$rootScope.billdata.product,productcode:appvariables.get("productcode")[0].valueaddition,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:"1",weight:$rootScope.billdata.valueaddition,purity:$rootScope.billdata.purity});datapkgdetails.push({storeid:rowdata.storeid,"package":$rootScope.billdata.package,packagecode:$rootScope.billdata.packages_code,product:$rootScope.billdata.product,productcode:appvariables.get("productcode")[0].wastage,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:"1",weight:$rootScope.billdata.wastage,purity:$rootScope.billdata.purity});datapkgdetails.push({storeid:rowdata.storeid,"package":$rootScope.billdata.package,packagecode:$rootScope.billdata.packages_code,product:$rootScope.billdata.product,productcode:appvariables.get("productcode")[0].stoneweight,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:"1",weight:$rootScope.billdata.stoneweight,purity:$rootScope.billdata.purity});datapkgdetails.push({storeid:rowdata.storeid,"package":$rootScope.billdata.package,packagecode:$rootScope.billdata.packages_code,product:$rootScope.billdata.product,productcode:appvariables.get("productcode")[0].makingexpense,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:"1",weight:$rootScope.billdata.makingexpense,purity:$rootScope.billdata.purity});datapkgdetails.push({storeid:rowdata.storeid,"package":$rootScope.billdata.package,packagecode:$rootScope.billdata.packages_code,product:$rootScope.billdata.product,productcode:appvariables.get("productcode")[0].makingcharge,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:"1",weight:$rootScope.billdata.makingcharge,purity:$rootScope.billdata.purity});datapkgdetails.push({storeid:rowdata.storeid,"package":$rootScope.billdata.package,packagecode:$rootScope.billdata.packages_code,product:$rootScope.billdata.product,productcode:appvariables.get("productcode")[0].makingexpense,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:"1",weight:$rootScope.billdata.makingexpense,purity:$rootScope.billdata.purity});datapkgdetails.push({storeid:rowdata.storeid,"package":$rootScope.billdata.package,packagecode:$rootScope.billdata.packages_code,product:$rootScope.billdata.product,productcode:appvariables.get("productcode")[0].stonevalue,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:"1",weight:$rootScope.billdata.stonevalue,purity:$rootScope.billdata.purity});var pkgdata={data:datapkgdetails};var x2js=new X2JS;var transactionData="<root>"+x2js.json2xml_str(pkgdata)+"</root>";$rootScope.billdata.transactiondetail=transactionData;$rootScope.billdata.updatesummary=1;servicesservice.savetransaction($rootScope.billdata,function(response){if(response!=undefined){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){$scope.listtransaction();logger.logSuccess("transaction saved.");$scope.clearbilldata();$scope.closepanel()}else{logger.logError("unable to save transaction. please contact support.")}}else{logger.logWarning("transaction not added.")}})};$scope.savetransactionpurchasetest=function(rowdata){$rootScope.billdata.transactionid=rowdata.transactionid;$rootScope.billdata.transactiontype=rowdata.transactiontype;$rootScope.billdata.package=rowdata.packageid;$rootScope.billdata.packagecode=rowdata.packagecode;$rootScope.billdata.product=rowdata.productid;$rootScope.billdata.productcode=rowdata.product_code;$rootScope.billdata.category=rowdata.category;$rootScope.billdata.quantity=0;$rootScope.billdata.rate=rowdata.rate;$rootScope.billdata.purity=rowdata.purity;$rootScope.billdata.updatesummary=1;$rootScope.billdata.comments="transaction bill charges";var datapkgdetails=[];datapkgdetails.splice(0,datapkgdetails.length);datapkgdetails.push({storeid:rowdata.storeid,"package":rowdata.packageid,packagecode:rowdata.packages_code,product:$rootScope.billdata.product,productcode:appvariables.get("productcode")[0].testpurity,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:"1",weight:$rootScope.billdata.testpurity,purity:$rootScope.billdata.testpurity});datapkgdetails.push({storeid:rowdata.storeid,"package":$rootScope.billdata.package,packagecode:$rootScope.billdata.packages_code,product:$rootScope.billdata.product,productcode:appvariables.get("productcode")[0].testweight,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:"1",weight:$rootScope.billdata.testweight,purity:$rootScope.billdata.purity});datapkgdetails.push({storeid:rowdata.storeid,"package":$rootScope.billdata.package,packagecode:$rootScope.billdata.packages_code,product:$rootScope.billdata.product,productcode:appvariables.get("productcode")[0].testreturn,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:"1",weight:$rootScope.billdata.testreturnweight,purity:$rootScope.billdata.purity});datapkgdetails.push({storeid:rowdata.storeid,"package":$rootScope.billdata.package,packagecode:$rootScope.billdata.packages_code,product:$rootScope.billdata.product,productcode:appvariables.get("productcode")[0].puregold,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:"1",weight:$rootScope.billdata.puregoldweight,purity:100});var pkgdata={data:datapkgdetails};var x2js=new X2JS;var transactionData="<root>"+x2js.json2xml_str(pkgdata)+"</root>";$rootScope.billdata.transactiondetail=transactionData;$rootScope.billdata.updatesummary=1;servicesservice.savetransaction($rootScope.billdata,function(response){if(response!=undefined){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){$scope.listtransaction();logger.logSuccess("transaction saved.");$scope.clearbilldata();$scope.closepanel()}else{logger.logError("unable to save transaction. please contact support.")}}else{logger.logWarning("transaction not added.")}})};$scope.removetransaction=function(rowdata){$rootScope.billdata.comments="approval delete";$rootScope.billdata.transactiontype=rowdata.transactiontype;$rootScope.billdata.transactionid=rowdata.transactionid;$rootScope.billdata.package=rowdata.packageid;$rootScope.billdata.quantity=-+rowdata.quantity;$rootScope.billdata.weight=-+rowdata.productvalue;$rootScope.billdata.store=appvariables.get("storetype")[0].display;$rootScope.billdata.updatesummary=1;servicesservice.removetransaction($rootScope.billdata,function(response){if(response!=undefined){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){logger.logSuccess("transaction removed.");$scope.closepanel();$scope.listtransaction()}else{logger.logError("unable to complete your request. please contact support.")}}else{logger.logWarning("transaction not added.")}})};$scope.generatebill=function(billcharges,useraction){var uniquebilldates="";var uniquetransactionid="";var uniquetransactionidlist="";for(var key in $rootScope.transactionalcharges){if($rootScope.transactionalcharges[key].excludetransaction==0){uniquebilldates=uniquebilldates+utilities.date2Format(billcharges[key].transactiondate,"yyyy/mm/dd");uniquetransactionid=uniquetransactionid+billcharges[key].transactionid;if(key<billcharges.length-1){uniquebilldates=uniquebilldates+",";uniquetransactionid=uniquetransactionid+","}}}uniquetransactionidlist=uniquetransactionid;var uniquebilldates="<root><data><ddata>"+uniquebilldates+"</ddata></data></root>";var uniquetransactionid="<root><data><tdata>"+uniquetransactionid+"</tdata></data></root>";var formdata={company:$rootScope.company,customer:$rootScope.billdata.customer,customertype:$rootScope.billdata.customertype,customername:$rootScope.billdata.customername,customeroutstandingtype:$rootScope.billdata.customeroutstandingtype,billdates:uniquebilldates,transactionidlist:uniquetransactionid,actiontype:useraction};$rootScope.base64encodedpdf="";var printoptions={company:$rootScope.billdata.company,customer:$rootScope.billdata.customer,customertype:$rootScope.billdata.customertype,transactionlist:uniquetransactionidlist,billtype:"salesbill",receiptno:0,fromdate:"",todate:"",billdatafromclient:$rootScope.transactionalcharges,action:useraction};printservice.salesbill(printoptions,function(response){$rootScope.base64encodedpdf=$sce.trustAsResourceUrl(response)});ngDialog.open({template:"modelcustomerbill",className:"ngdialog-theme-default custom-width",closeByDocument:false})};$scope.onchangestock=function(data){$rootScope.stockdata.movementtype=data;if($rootScope.stockdata.movementtype==1){$rootScope.stockdata.diplaystockquantitytemp=$rootScope.stockdata.diplaystockquantity+ +$rootScope.stockdata.movementquantity;$rootScope.stockdata.diplaystockweighttemp=+$rootScope.stockdata.diplaystockweight+ +$rootScope.stockdata.movementweight;$rootScope.stockdata.godownstockquantitytemp=+$rootScope.stockdata.totalpackagequantity-+$rootScope.stockdata.diplaystockquantitytemp;$rootScope.stockdata.godownstockweighttemp=+$rootScope.stockdata.totalpackageweight-+$rootScope.stockdata.diplaystockweighttemp}if($rootScope.stockdata.movementtype==2){$rootScope.stockdata.godownstockquantitytemp=+$rootScope.stockdata.godownstockquantity+ +$rootScope.stockdata.movementquantity;$rootScope.stockdata.godownstockweighttemp=+$rootScope.stockdata.godownstockweight+ +$rootScope.stockdata.movementweight;$rootScope.stockdata.diplaystockquantitytemp=+$rootScope.stockdata.totalpackagequantity-+$rootScope.stockdata.godownstockquantitytemp;$rootScope.stockdata.diplaystockweighttemp=+$rootScope.stockdata.totalpackageweight-+$rootScope.stockdata.godownstockweighttemp}};$scope.onselectstockitem=function(data){$rootScope.stockdata.diplaystockquantitytemp=0;$rootScope.stockdata.diplaystockweighttemp=0;$rootScope.stockdata.godownstockquantitytemp=0;$rootScope.stockdata.godownstockweighttemp=0;$rootScope.stockdata.diplaystockquantity=0;$rootScope.stockdata.diplaystockweight=0;$rootScope.stockdata.godownstockquantity=0;$rootScope.stockdata.godownstockweight=0;$rootScope.stockdata.netstockquantity=0;$rootScope.stockdata.netstockweight=0;$rootScope.stockdata.totalpackagequantity=0;$rootScope.stockdata.totalpackageweight=0;$rootScope.stockdata.movementquantity=0;$rootScope.stockdata.movementweight=0;$rootScope.stockdata.package=data.packageid;var selecteditemnetstock=filterfunction.filterarray($rootScope.netstock,{"package":$rootScope.stockdata.package});var rowdata;for(var key in selecteditemnetstock){rowdata=selecteditemnetstock[key];if(rowdata.store==appvariables.get("storetype")[0].display){$rootScope.stockdata.diplaystockquantity=rowdata.quantity;$rootScope.stockdata.diplaystockweight=utilities.roundtodecimal(rowdata.weight,3)}else if(rowdata.store==appvariables.get("storetype")[0].godown){$rootScope.stockdata.godownstockquantity=rowdata.quantity;$rootScope.stockdata.godownstockweight=utilities.roundtodecimal(rowdata.weight,3)}else{$rootScope.stockdata.netstockquantity=rowdata.quantity;$rootScope.stockdata.netstockweight=utilities.roundtodecimal(rowdata.weight,3)}}$rootScope.stockdata.totalpackagequantity=utilities.roundtodecimal(+$rootScope.stockdata.diplaystockquantity+ +$rootScope.stockdata.godownstockquantity,3);$rootScope.stockdata.totalpackageweight=utilities.roundtodecimal(+$rootScope.stockdata.diplaystockweight+ +$rootScope.stockdata.godownstockweight,3);$rootScope.stockdata.diplaystockquantitytemp=utilities.roundtodecimal($rootScope.stockdata.diplaystockquantity,3);$rootScope.stockdata.diplaystockweighttemp=utilities.roundtodecimal($rootScope.stockdata.diplaystockweight,3);$rootScope.stockdata.godownstockquantitytemp=utilities.roundtodecimal($rootScope.stockdata.godownstockquantity,3);$rootScope.stockdata.godownstockweighttemp=utilities.roundtodecimal($rootScope.stockdata.godownstockweight,3)};$scope.liststock=function(data){servicesservice.liststock($rootScope.stockdata,function(response){if(response!=undefined){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){$rootScope.currentstockallstore=response;$rootScope.currentstock=filterfunction.filterarray($rootScope.currentstockallstore,{storeid:$rootScope.stockdata.store});$rootScope.netstock=[];var mypackage,rowdata;var netquantity=0,netweight=0,itemnetquantity=0,itemnetweight=0;var packagegroup=_.groupBy($rootScope.currentstock,"packageid");for(var key in packagegroup){mypackage=packagegroup[key];for(var row in mypackage){rowdata=mypackage[row];netquantity=+netquantity+ +rowdata.opbalquantity+ +rowdata.returnquantity+ +rowdata.salesreturnquantity-+rowdata.salequantity-+rowdata.issuequantity+rowdata.movementquantity;netweight=+netweight+ +rowdata.opbalweight+ +rowdata.purchaseweight+ +rowdata.returnweight+ +rowdata.salesreturnweight-+rowdata.saleweight-+rowdata.issueweight+ +rowdata.movementweight}}$rootScope.liststocknetquantity=netquantity;$rootScope.liststocknetweight=utilities.roundtodecimal(netweight,3);$rootScope.netstock=[];var mypackage,rowdata;var netquantity=0,netweight=0,itemnetquantity=0,itemnetweight=0;var packagegroup=_.groupBy($rootScope.currentstockallstore,"packageid");for(var key in packagegroup){mypackage=packagegroup[key];for(var row in mypackage){rowdata=mypackage[row];itemnetquantity=+rowdata.opbalquantity+ +rowdata.returnquantity+ +rowdata.salesreturnquantity-+rowdata.salequantity-+rowdata.issuequantity+ +rowdata.movementquantity;itemnetweight=+rowdata.opbalweight+ +rowdata.purchaseweight+ +rowdata.returnweight+ +rowdata.salesreturnweight-+rowdata.saleweight-+rowdata.issueweight+ +rowdata.movementweight;netquantity=+netquantity+ +rowdata.opbalquantity+ +rowdata.returnquantity+ +rowdata.salesreturnquantity-+rowdata.salequantity-+rowdata.issuequantity+rowdata.movementquantity;netweight=+netweight+ +rowdata.opbalweight+ +rowdata.purchaseweight+ +rowdata.returnweight+ +rowdata.salesreturnweight-+rowdata.saleweight-+rowdata.issueweight+ +rowdata.movementweight;$rootScope.netstock.push({store:rowdata.storeid,"package":rowdata.packageid,quantity:itemnetquantity,weight:itemnetweight})}$rootScope.netstock.push({store:0,"package":+key[0],quantity:netquantity,weight:netweight})}}else{logger.logError("unable to load stock. please contact support")}}else{logger.logWarning("stock not available")}})};$scope.savestock=function(){if($rootScope.stockdata.company==undefined||$rootScope.billdata.company==0){logger.logWarning("missing company information. please re-login to continue.");return}if($rootScope.stockdata.package==undefined||$rootScope.stockdata.package==0){logger.logWarning("stock item not selected. please refresh");return}if($rootScope.stockdata.opstockquantity==undefined||$rootScope.stockdata.opstockquantity<0){logger.logWarning("invalid stock quantity.");return}if($rootScope.stockdata.opstockweight==undefined||$rootScope.stockdata.opstockweight<0){logger.logWarning("invalid stock weight.");return}if($rootScope.stockdata.comments==undefined||$rootScope.stockdata.comments==""){logger.logWarning("please enter comments.");return}$rootScope.stockdata.comments="Adjust Stock: "+$rootScope.stockdata.comments;servicesservice.savestock($rootScope.stockdata,function(response){if(response!=undefined){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){logger.logSuccess("Opening stock update complete.");$scope.liststock($rootScope.stockdata);$scope.clearstockdata()}else{logger.logError("unable to edit opening stock. please contact support")}}else{logger.logError("unable to edit opening stock. please contact support")}})};$scope.movestock=function(){if($rootScope.stockdata.movementquantity<0||$rootScope.stockdata.movementquantity==undefined||$rootScope.stockdata.movementweight==0||$rootScope.stockdata.movementweight==undefined){logger.logWarning("please enter quantity and weight to be moved.");return}if($rootScope.stockdata.company==undefined||$rootScope.billdata.company==0){logger.logWarning("missing company information. please re-login to continue.");return}if($rootScope.stockdata.package==undefined||$rootScope.stockdata.package==0){logger.logWarning("stock item not selected. please refresh");return}if($rootScope.stockdata.diplaystockquantity==undefined){logger.logWarning("information missing, display stock.");return}if($rootScope.stockdata.godownstockquantity==undefined){logger.logWarning("information missing, godown stock.");return}if($rootScope.stockdata.comments==undefined||$rootScope.stockdata.comments==""){logger.logWarning("please enter comments.");return}if($rootScope.stockdata.movementtype==1){$rootScope.stockdata.newdiplaystockquantity=utilities.roundtodecimal(+$rootScope.stockdata.diplaystockquantity+ +$rootScope.stockdata.movementquantity,3);$rootScope.stockdata.newdiplaystockweight=utilities.roundtodecimal(+$rootScope.stockdata.diplaystockweight+ +$rootScope.stockdata.movementweight,3);$rootScope.stockdata.newgodownstockquantity=utilities.roundtodecimal(+$rootScope.stockdata.godownstockquantity-+$rootScope.stockdata.movementquantity,3);$rootScope.stockdata.newgodownstockweight=utilities.roundtodecimal(+$rootScope.stockdata.godownstockweight-+$rootScope.stockdata.movementweight,3)}else if($rootScope.stockdata.movementtype==2){$rootScope.stockdata.newdiplaystockquantity=utilities.roundtodecimal(+$rootScope.stockdata.diplaystockquantity-+$rootScope.stockdata.movementquantity,3);$rootScope.stockdata.newdiplaystockweight=utilities.roundtodecimal(+$rootScope.stockdata.diplaystockweight-+$rootScope.stockdata.movementweight,3);$rootScope.stockdata.newgodownstockquantity=utilities.roundtodecimal(+$rootScope.stockdata.godownstockquantity+ +$rootScope.stockdata.movementquantity,3);$rootScope.stockdata.newgodownstockweight=utilities.roundtodecimal(+$rootScope.stockdata.godownstockweight+ +$rootScope.stockdata.movementweight,3)}$rootScope.stockdata.comments="Move Stock: "+$rootScope.stockdata.comments;servicesservice.movestock($rootScope.stockdata,function(response){if(response!=undefined){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){logger.logSuccess("stock updated.");$scope.liststock($rootScope.stockdata);$scope.clearstockdata()}else{logger.logError("unable to move stock. please contact support")}}else{logger.logError("unable to move stock. please contact support")}})};$scope.cancelstockchanges=function(){$rootScope.stockdata.diplaystockquantitytemp=$rootScope.stockdata.diplaystockquantity;$rootScope.stockdata.diplaystockweighttemp=$rootScope.stockdata.diplaystockweight;$rootScope.stockdata.godownstockquantitytemp=$rootScope.stockdata.godownstockquantity;$rootScope.stockdata.godownstockweighttemp=$rootScope.stockdata.godownstockweight;$rootScope.stockdata.movementquantity=0;$rootScope.stockdata.movementweight=0};$scope.listvalueaddition=function(){if($rootScope.billdata.company==undefined||$rootScope.billdata.company==0){logger.logWarning("missing company information. please re-login to continue.");return}servicesservice.listvalueaddition($rootScope.billdata,function(response){if(response!=undefined){$rootScope.listallvalueaddition=response}else{logger.logError("unable to load VA. please contact support")}})};$scope.removevalueaddition=function(data){$rootScope.stockdata.va=data.vaid;servicesservice.removevalueaddition($rootScope.stockdata,function(response){if(response!=undefined){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){logger.logSuccess("VA removed successfully.");$scope.listvalueaddition();$scope.liststock($rootScope.stockdata)}else{logger.logError("failed to remove VA.")}}else{logger.logWarning("transaction failed. please contact support.")}})};$scope.addvalueaddition=function(){if($rootScope.stockdata.company==undefined||$rootScope.billdata.company==0){logger.logWarning("missing company information. please re-login to continue.");return}if($rootScope.stockdata.package==undefined||$rootScope.stockdata.package==0){logger.logWarning("stock item not selected. please refresh");return}if($rootScope.stockdata.vamax==undefined||$rootScope.stockdata.vamax==0){logger.logWarning("missing value VA maximum.");return}if($rootScope.stockdata.vamin==undefined||$rootScope.stockdata.vamin==0){logger.logWarning("missing value VA minimum.");return}if($rootScope.stockdata.vapercentage==undefined||$rootScope.stockdata.vapercentage==0){logger.logWarning("missing value for VA percentage.");return}servicesservice.addvalueaddition($rootScope.stockdata,function(response){if(response!=undefined){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){logger.logSuccess("VA added successfully.");$scope.listvalueaddition();$scope.liststock($rootScope.stockdata);$scope.clearstockdata()}else{logger.logError("unable to add VA. please contact support")}}else{logger.logError("unable to load VA. please contact support")}})};$scope.packagefilter=function(item){if(item.storeid==1){return item.package_title!="cash"&&item.package_title!="995"&&item.package_title!="oldgold"&&item.package_title!="puregold"}else{return true}};$scope.addcategory=function(){if($rootScope.stockdata.categoryname==""||$rootScope.stockdata.categoryname==undefined){logger.logWarning("enter category name.");return}if($rootScope.stockdata.package==0||$rootScope.stockdata.package==undefined){logger.logWarning("select item.");return}servicesservice.addcategory($rootScope.stockdata,function(response){if(response!=undefined){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){logger.logSuccess("new category added.");$scope.listcategoryforstock()}else{logger.logError("unable to add category. please contact support.")}}else{logger.logWarning("category not added.")}})};$scope.listcategory=function(){var formdata=$rootScope.billdata;if($rootScope.billdata.store==undefined||$rootScope.billdata.store==0){logger.logWarning("please select store.");return}else{servicesservice.listcategory(formdata,function(responsedata){if(responsedata!=undefined){$rootScope.listcategory=responsedata}else{logger.logError("category details not available.")}})}};$scope.listcategoryforstock=function(){$scope.listcategory();$scope.listcategorymaster=$rootScope.listcategory};$scope.deletecategory=function(data){$rootScope.stockdata.category=data.categoryid;servicesservice.deletecategory($rootScope.stockdata,function(response){if(response!=undefined){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){logger.logSuccess("removed category.");$scope.listcategoryforstock()}else{logger.logError("unable to delete category. please contact support")}}else{logger.logWarning("failed to remove category.")}})};$scope.calculateresult=function(goldsmithtransactiontype){var basepurity=appvariables.get("basepuritypercentage");var retailrate=appvariables.get("retailrate");var wholesalerate=appvariables.get("wholesalerate");if(goldsmithtransactiontype=="issue"){$rootScope.billdata.issueoldgoldnetweight=utilities.roundtodecimal(+$rootScope.billdata.issueoldgoldweight*+$rootScope.billdata.issueoldgoldpurity/+basepurity,3);if($rootScope.billdata.issue995goldpurity<+92){$rootScope.billdata.issue995goldnetweight=utilities.roundtodecimal(+$rootScope.billdata.issue995goldweight*+$rootScope.billdata.issue995goldpurity/+100,3)}else{$rootScope.billdata.issue995goldnetweight=utilities.roundtodecimal(+$rootScope.billdata.issue995goldweight*+$rootScope.billdata.issue995goldpurity/+basepurity,3)}$rootScope.billdata.netcashissueweight=utilities.roundtodecimal(+$rootScope.billdata.cashissued/+wholesalerate,3);$rootScope.billdata.netgoldsmithissueweight=utilities.roundtodecimal(+$rootScope.billdata.issueoldgoldnetweight+ +$rootScope.billdata.issue995goldnetweight+ +$rootScope.billdata.netcashissueweight,3)}else if(goldsmithtransactiontype=="return"){var netweight=+$rootScope.billdata.weight-+$rootScope.billdata.stoneweight;if(+$rootScope.billdata.valueaddition==0){var grossvalue=(+netweight+ +$rootScope.billdata.wastage)*(+$rootScope.billdata.purity/+basepurity)}else if(+$rootScope.billdata.wastage==0){var grossvalue=+netweight*(+$rootScope.billdata.purity+ +$rootScope.billdata.valueaddition)/+basepurity}else{var grossvalue=(+netweight+ +$rootScope.billdata.wastage)*(+$rootScope.billdata.purity+ +$rootScope.billdata.valueaddition)/+basepurity}var netvalue=+grossvalue;if(isNaN(netvalue)){netvalue=0}var netvalueinweight=utilities.roundtodecimal(+netvalue,3);$rootScope.billdata.netgoldsmithreturnweight=netvalueinweight}else if(goldsmithtransactiontype=="selfpurchase"){$rootScope.calculatedamount=utilities.roundtodecimal(+$rootScope.billdata.weight/$rootScope.billdata.metalrate,2)}else if(goldsmithtransactiontype=="cashreceipt"){$rootScope.calculatedamount=utilities.roundtodecimal(+$rootScope.billdata.weight/+$rootScope.billdata.metalrate,3)}};$scope.calculateconversion=function(){if($rootScope.selectedtabcontrol=="purchase"){$rootScope.calculatedamount=utilities.roundtodecimal(+$rootScope.billdata.purity*+$rootScope.billdata.weight/+100*+$rootScope.billdata.metalrate,2)}};$scope.savetransactiongoldsmith=function(){if($rootScope.billdata.goldsmithtransactiontype==appvariables.get("transactiontype")[0].issue){$rootScope.billdata.comments="gold smith issue";var datapkgdetails=[];var transactionData1;var transactionData2;var transactionData3;if($scope.validateinput()){$rootScope.billdata.updatesummary=0;if(+$rootScope.billdata.issueoldgoldweight>0){$rootScope.billdata.packagecode=appvariables.get("packagecode")[0].oldgold;$rootScope.billdata.quantity=0;$rootScope.billdata.weight=$rootScope.billdata.issueoldgoldweight;if($rootScope.billdata.weight>0){$rootScope.billdata.quantity=1;$rootScope.billdata.updatesummary=1}$rootScope.billdata.purity=$rootScope.billdata.issueoldgoldpurity;var datapkgdetails1=[];datapkgdetails1.push({storeid:appvariables.get("storetype")[0].godown,"package":$rootScope.billdata.package,packagecode:appvariables.get("packagecode")[0].oldgold,product:$rootScope.billdata.product,productcode:appvariables.get("productcode")[0].oldgold,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:$rootScope.billdata.quantity,weight:$rootScope.billdata.issueoldgoldweight,purity:$rootScope.billdata.issueoldgoldpurity});var pkgdata1={data:datapkgdetails1};var x2js=new X2JS;var transactionData1="<root>"+x2js.json2xml_str(pkgdata1)+"</root>"}$rootScope.billdata.updatesummary=0;if(+$rootScope.billdata.issue995goldweight>0){$rootScope.billdata.packagecode=appvariables.get("packagecode")[0].gold995;$rootScope.billdata.quantity=0;$rootScope.billdata.weight=$rootScope.billdata.issue995goldweight;if($rootScope.billdata.weight>0){$rootScope.billdata.quantity=1;$rootScope.billdata.updatesummary=1}$rootScope.billdata.purity=$rootScope.billdata.issue995goldpurity;var datapkgdetails2=[];datapkgdetails2.push({storeid:appvariables.get("storetype")[0].godown,"package":$rootScope.billdata.package,packagecode:appvariables.get("packagecode")[0].gold995,product:$rootScope.billdata.product,productcode:appvariables.get("productcode")[0].gold,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:$rootScope.billdata.quantity,weight:$rootScope.billdata.issue995goldweight,purity:$rootScope.billdata.issue995goldpurity});var pkgdata2={data:datapkgdetails2};var x2js=new X2JS;var transactionData2="<root>"+x2js.json2xml_str(pkgdata2)+"</root>"}$rootScope.billdata.updatesummary=0;if(+$rootScope.billdata.cashissued>0){$rootScope.billdata.packagecode=appvariables.get("packagecode")[0].cash;$rootScope.billdata.quantity=1;$rootScope.billdata.updatesummary=1;var datapkgdetails3=[];datapkgdetails3.push({storeid:appvariables.get("storetype")[0].godown,"package":$rootScope.billdata.package,packagecode:appvariables.get("packagecode")[0].cash,product:$rootScope.billdata.product,productcode:appvariables.get("productcode")[0].cash,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:$rootScope.billdata.quantity,weight:$rootScope.billdata.cashissued,purity:appvariables.get("basepuritypercentage")});var pkgdata3={data:datapkgdetails3};var x2js=new X2JS;var transactionData3="<root>"+x2js.json2xml_str(pkgdata3)+"</root>"}$rootScope.billdata.transactiondetail=transactionData1;$rootScope.billdata.updatesummary=0;if($rootScope.billdata.transactiondetail!=undefined){$rootScope.billdata.updatesummary=1}servicesservice.savetransactionwithpromise($rootScope.billdata).then(function(response1){$rootScope.billdata.transactiondetail="<root>"+"</root>";$rootScope.billdata.transactiondetail=transactionData2;$rootScope.billdata.updatesummary=0;if($rootScope.billdata.transactiondetail!=undefined){$rootScope.billdata.updatesummary=1}servicesservice.savetransactionwithpromise($rootScope.billdata).then(function(response2){$rootScope.billdata.transactiondetail="<root>"+"</root>";$rootScope.billdata.transactiondetail=transactionData3;$rootScope.billdata.updatesummary=0;if($rootScope.billdata.transactiondetail!=undefined){$rootScope.billdata.updatesummary=1}servicesservice.savetransactionwithpromise($rootScope.billdata).then(function(response3){logger.logSuccess("transaction saved.");$rootScope.billdata.customertype=appvariables.get("customertype")[0].goldsmith;$scope.showissue=!$scope.showissue;$scope.listgoldsmithtransaction("issue");$scope.closepanel()})})})}}else if($rootScope.billdata.goldsmithtransactiontype==appvariables.get("transactiontype")[0].return){$rootScope.billdata.comments="gold smith return";$rootScope.billdata.store=appvariables.get("storetype")[0].godown;var datapkgdetails=[];datapkgdetails.push({storeid:appvariables.get("storetype")[0].godown,"package":$rootScope.billdata.package,packagecode:$rootScope.billdata.packagecode,product:$rootScope.billdata.product,productcode:$rootScope.billdata.productcode,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:$rootScope.billdata.quantity,weight:$rootScope.billdata.weight,purity:$rootScope.billdata.purity});datapkgdetails.push({storeid:appvariables.get("storetype")[0].godown,"package":$rootScope.billdata.package,packagecode:$rootScope.billdata.packagecode,product:$rootScope.billdata.product,productcode:appvariables.get("productcode")[0].valueaddition,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:"1",weight:$rootScope.billdata.valueaddition,purity:appvariables.get("basepuritypercentage")});
datapkgdetails.push({storeid:appvariables.get("storetype")[0].godown,"package":$rootScope.billdata.package,packagecode:$rootScope.billdata.packagecode,product:$rootScope.billdata.product,productcode:appvariables.get("productcode")[0].wastage,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:"1",weight:$rootScope.billdata.wastage,purity:appvariables.get("basepuritypercentage")});datapkgdetails.push({storeid:appvariables.get("storetype")[0].godown,"package":$rootScope.billdata.package,packagecode:$rootScope.billdata.packagecode,product:$rootScope.billdata.product,productcode:appvariables.get("productcode")[0].stoneweight,category:$rootScope.billdata.category,price:$rootScope.billdata.metalrate,quantity:"1",weight:$rootScope.billdata.stoneweight,purity:appvariables.get("basepuritypercentage")});var pkgdata={data:datapkgdetails};var x2js=new X2JS;var transactionData="<root>"+x2js.json2xml_str(pkgdata)+"</root>";$rootScope.billdata.transactiondetail=transactionData;if($scope.validateinput()){$rootScope.billdata.updatesummary=1;servicesservice.savetransaction($rootScope.billdata,function(response){if(response!=undefined){if(response[0].result!="NODATA"&&response[0].result!="ERROR"){logger.logSuccess("transaction saved.");$scope.clearbilldata();$rootScope.billdata.customertype=appvariables.get("customertype")[0].goldsmith;if($rootScope.billdata.goldsmithtransactiontype==appvariables.get("transactiontype")[0].issue){$scope.listgoldsmithtransaction("issue")}else{$scope.listgoldsmithtransaction("return");if($scope.listpackage.length>0){$scope.billpackage=0}}$("#packageitem").focus()}else{logger.logError("unable to save transaction. please contact support.")}}else{logger.logWarning("transaction not added.")}})}}};$scope.listgoldsmithtransaction=function(goldsmithtransactiontype){if(goldsmithtransactiontype=="issue"){$scope.clearbilldata();$rootScope.billdata.transactiontype=appvariables.get("transactiontype")[0].issue;$rootScope.billdata.goldsmithtransactiontype=appvariables.get("transactiontype")[0].issue;$("#smitholdgoldweight").focus()}else if(goldsmithtransactiontype=="return"){$scope.clearbilldata();$rootScope.billdata.transactiontype=appvariables.get("transactiontype")[0].return;$rootScope.billdata.goldsmithtransactiontype=appvariables.get("transactiontype")[0].return;$("#packageitem").focus()}$rootScope.billdata.customertype=appvariables.get("customertype")[0].goldsmith;$rootScope.billdata.store=appvariables.get("storetype")[0].godown;$scope.listtransaction()};$scope.assignorder=function(order,selectedsmith,duedate){if(selectedsmith==null|selectedsmith==undefined){logger.logWarning("please select goldsmith");return}else if(duedate==null|duedate==undefined){logger.logWarning("please select due date");return}var formdata={company:$rootScope.company,order:order.transactionid,duedate:utilities.date2Format(duedate,"yyyy-mm-dd"),assignedto:selectedsmith.customerid};servicesservice.assignorder(formdata,function(responsedata){logger.logSuccess("order updated successfully.");$scope.listorder()})};$scope.showordercustomeraddress=function(){ngDialog.open({template:"modelnewcustomer",className:"ngdialog-theme-default custom-width",closeByDocument:false})};$scope.saveaddress=function(){var formdata=$rootScope.addressdata;if($rootScope.addressdata.cname==undefined||$rootScope.addressdata.cname==0){logger.logWarning("please enter customer.");return}else{servicesservice.saveaddress(formdata,function(responsedata){if(responsedata[0].result=="SUCCESS"){logger.logSuccess("address saved successfully.");$scope.listaddress();$scope.selectaddress($rootScope.addressdata)}else{logger.logError("failed to save address.")}})}};$scope.listaddress=function(){var formdata=$rootScope.addressdata;if($rootScope.addressdata.company==undefined||$rootScope.addressdata.company==0){logger.logWarning("please re-login to continue.");return}else{servicesservice.listaddress(formdata,function(responsedata){if(responsedata!=undefined){if(responsedata[0].result!="NODATA"&&responsedata[0].result!="ERROR"){$scope.listaddress=responsedata}else{logger.logError("failed to list address.")}}})}};$scope.listorder=function(){var formdata=$rootScope.billdata;if($rootScope.billdata.company==undefined||$rootScope.billdata.company==0){logger.logWarning("please re-login to continue.");return}else{servicesservice.listorder(formdata,function(responsedata){if(responsedata!=undefined){if(responsedata[0].result!="NODATA"&&responsedata[0].result!="ERROR"){$scope.listpendingorder=responsedata}else{logger.logWarning("no orders found.")}}})}};$scope.filteraddress=function(filtervalue){if(filtervalue==undefined||filtervalue==""){logger.logWarning("enter name to search.");return}else{$scope.listaddressfiltered=filterfunction.filterarray($scope.listaddress,{cname:filtervalue});if($scope.listaddressfiltered==undefined||$scope.listaddressfiltered==""){logger.logWarning("no match found.")}}};$scope.selectaddress=function(rowdata){$rootScope.billdata.customer=rowdata.customerid;for(var key in $scope.listcustomer){if($scope.listcustomer[key].cname.trim()==rowdata.cname.trim()){$rootScope.billcustomer=$scope.listcustomer[key];$scope.shownewaddress=false;return}}};$scope.updateorderstatus=function(row,status){var formdata={company:row.companyid,order:row.transactionid,status:status};servicesservice.updateorderstatus(formdata,function(responsedata){if(responsedata[0].result=="SUCCESS"){logger.logSuccess("order status updated successfully.");$scope.listorder()}else{logger.logError("failed to update order status.")}})};$scope.clearstockdata=function(){$rootScope.stockdata.package=0;$rootScope.stockdata.packagecode=0;$rootScope.stockdata.category=0;$rootScope.stockdata.categoryname=0;$rootScope.stockdata.metalrate=0;$rootScope.stockdata.quantity=0;$rootScope.stockdata.weight=0;$rootScope.stockdata.purity=0;$rootScope.stockdata.va=0;$rootScope.stockdata.vamin=0;$rootScope.stockdata.vamax=0;$rootScope.stockdata.vapercentage=0;$rootScope.stockdata.vacustomertype=1;$rootScope.stockdata.opstockquantity=0;$rootScope.stockdata.opstockweight=0;$rootScope.stockdata.diplaystockquantity=0;$rootScope.stockdata.diplaystockweight=0;$rootScope.stockdata.godownstockquantity=0;$rootScope.stockdata.godownstockweight=0;$rootScope.stockdata.netstockquantity=0;$rootScope.stockdata.netstockweight=0;$rootScope.stockdata.comments=""};$scope.clearbilldata=function(){$rootScope.billdata.package=0;$rootScope.billdata.packagecode=0;$rootScope.billdata.product=0;$rootScope.billdata.productcode=0;$rootScope.billdata.category=0;$rootScope.billdata.quantity=0;$rootScope.billdata.weight=0;$rootScope.billdata.returnquantity=0;$rootScope.billdata.returnproductvalue=0;$rootScope.billdata.cashreceived=0;$rootScope.billdata.calculatedweight=0;$rootScope.billdata.transactionid=0;$rootScope.billdata.transactiondate=$rootScope.currentdate;$rootScope.billdata.receiptno=0;$rootScope.billdata.makingexpense=0;$rootScope.billdata.makingcharge=0;$rootScope.billdata.valueaddition=0;$rootScope.billdata.wastage=0;$rootScope.billdata.stoneweight=0;$rootScope.billdata.stonevalue=0;$rootScope.billdata.testweight=0;$rootScope.billdata.testreturnweight=0;$rootScope.billdata.puregoldweight=0;$rootScope.billdata.testpurity=0;$rootScope.billdata.transactiondetail="";$rootScope.billdata.comments="";$rootScope.billdata.updatesummary=1;$rootScope.calculatedamount=0;$scope.billcategory=0;$rootScope.billdata.issueoldgoldweight=0;$rootScope.billdata.issueoldgoldpurity=0;$rootScope.billdata.issueoldgoldnetweight=0;$rootScope.billdata.issue995goldweight=0;$rootScope.billdata.issue995goldpurity=appvariables.get("basepuritypercentage");$rootScope.billdata.issue995goldnetweight=0;$rootScope.billdata.netgoldsmithissueweight=0;$rootScope.billdata.netgoldsmithreturnweight=0;$rootScope.billdata.cashissued=0;$rootScope.billdata.cashreceived=0;$rootScope.billdata.netcashissueweight=0};$scope.closepanel=function(){$rootScope.billdata.product=0;$rootScope.billdata.productcode="";$rootScope.billdata.quantity=0;$rootScope.billdata.weight=0;$rootScope.billdata.purity=0;$rootScope.billdata.returnquantity=0;$rootScope.billdata.returnproductvalue=0;$rootScope.billdata.cashreceived=0;$rootScope.billdata.calculatedweight=0;$rootScope.billdata.transactionid=0;$rootScope.billdata.transactiondate=$rootScope.currentdate;$rootScope.billdata.receiptno=0;$rootScope.billdata.comments="";$rootScope.billdata.makingexpense=0;$rootScope.billdata.makingcharge=0;$rootScope.billdata.valueaddition=0;$rootScope.billdata.wastage=0;$rootScope.billdata.stoneweight=0;$rootScope.billdata.stonevalue=0;$rootScope.billdata.testweight=0;$rootScope.billdata.testreturnweight=0;$rootScope.billdata.puregoldweight=0;$rootScope.billdata.testpurity=0;$rootScope.billdata.transactiondetail="";$rootScope.billdata.goldsmithtransactiontype=0;$rootScope.billdata.issueoldgoldweight=0;$rootScope.billdata.issueoldgoldpurity=0;$rootScope.billdata.issueoldgoldnetweight=0;$rootScope.billdata.issue995goldweight=0;$rootScope.billdata.issue995goldpurity=appvariables.get("basepuritypercentage");$rootScope.billdata.issue995goldnetweight=0;$rootScope.billdata.netgoldsmithissueweight=0;$rootScope.billdata.netgoldsmithreturnweight=0;$rootScope.billdata.cashissued=0;$rootScope.billdata.cashreceived=0;$rootScope.billdata.netcashissueweight=0;$scope.collapsepanel=false;$scope.collapsebill=false;$scope.showsalesdetails=true;$scope.showpurchasedetails=true;$scope.hidereturn=true;$scope.hidebillsettings=true;$scope.hidestockdetails=true;$scope.hidevadetails=true;$scope.hidestockedit=true};$scope.onchangeedittransaction=function(data){$rootScope.editbilldata.transactiondate=utilities.date2Format(data.transactiondate,"yyyy-mm-dd");$scope.selectedtransactiontoedit=filterfunction.filterarray($scope.transactionitemlist,{transactionid:data.transactionid});var currentitem;for(var row in $scope.selectedtransactiontoedit){currentitem=$scope.selectedtransactiontoedit[row];$rootScope.editbilldata.package=currentitem.packageid;$rootScope.editbilldata.packagecode=currentitem.packages_code;$rootScope.editbilldata.packagename=currentitem.package_name;$rootScope.editbilldata.productcode=currentitem.product_code;$rootScope.editbilldata.categoryname=currentitem.categoryname;$rootScope.editbilldata.transactionid=currentitem.transactionid;$rootScope.editbilldata.transactiontype=currentitem.transactiontype;$rootScope.editbilldata.store=currentitem.storeid}$scope.listpackage=filterfunction.filterarray($scope.listpackage,{productcode:$rootScope.editbilldata.productcode})};$scope.savebilledit=function(){if($rootScope.editbilldata.user!=1&&$rootScope.editbilldata.transactiontype!=2){logger.logWarning("you are not authorized to edit this transaction. please contact admin");return}if($rootScope.editbilldata.transactiondate!=$rootScope.currentdate&&$rootScope.editbilldata.transactiontype!=2){logger.logWarning("you are allowed to edit only todays transaction.");return}$rootScope.editbilldata.transactiondetail=JSON.stringify($scope.selectedtransactiontoedit);servicesservice.savebilledit($rootScope.editbilldata,function(data){if(data!=undefined){logger.logSuccess("bill saved successfully.");$scope.selectedtransactiontoedit="";servicesservice.getreceipt($rootScope.editbilldata,function(data){if(data!=undefined){$scope.edittransactionlist=data[0];$scope.transactionitemlist=data[1]}else{logger.logWarning("receipt details not available")}})}else{logger.logWarning("error while processing bill edit request. please contact support")}})};$scope.liststore();$scope.listitemcategory();$scope.purchasefilter=function(row){return row.transactiontype=="2"&&row.product_code=="PW101"||row.transactiontype=="2"&&row.product_code=="PW995"};$scope.initstock=function(){$rootScope.billdata.productcode=appvariables.get("addonproductcode")[0].metal;$rootScope.listpackage=filterfunction.getpackagenames(appvariables.get("packagecode")[0].ornamentgold);$rootScope.listpackage=filterfunction.filterarray($scope.listpackage,{productcode:$rootScope.billdata.productcode});$rootScope.listpackage.splice(0,1);$scope.listvalueaddition();$scope.listcategory();$scope.hidereturn=true;$scope.hidebillsettings=true;$scope.hidestockdetails=true;$scope.hidevadetails=true;$scope.hidestockedit=true;$scope.hidestockmovement=true;$scope.hidestockgrid=false;$scope.hidecategorygrid=true};$scope.initorder=function(){$rootScope.billdata.productcode=appvariables.get("addonproductcode")[0].metal;$scope.listpackage=filterfunction.getpackagenames(appvariables.get("packagecode")[0].ornamentgold);$scope.listpackage=filterfunction.filterarray($scope.listpackage,{productcode:$rootScope.billdata.productcode});$scope.listpackage.splice(0,1);$rootScope.billdata.transactiontype=appvariables.get("transactiontype")[0].order;$rootScope.billdata.store=appvariables.get("storetype")[0].godown;$rootScope.billdata.customertype=appvariables.get("customertype")[0].retail;$scope.loadcustomer(appvariables.get("customertype")[0].retail);$rootScope.billdata.metalrate=appvariables.get("wholesalerate");$scope.shownewaddress=false;$scope.showorderstatus=false;$scope.listaddress();$scope.listorder();var formdata={company:$rootScope.company,customertype:appvariables.get("customertype")[0].goldsmith};servicesservice.loadcustomer(formdata,function(data){$scope.calculation=false;$scope.expenselist=false;if(data!=undefined){$scope.goldsmithcustomer=data}else{logger.logWarning("unable to load goldsmith.")}})};$scope.initsmith=function(){$rootScope.billdata.transactiondate=$rootScope.currentdate;$rootScope.billdata.productcode=appvariables.get("addonproductcode")[0].metal;$rootScope.billdata.metalrate=appvariables.get("wholesalerate");$rootScope.billdata.issue995goldpurity=appvariables.get("basepuritypercentage");$scope.listpackage=filterfunction.getpackagenames(appvariables.get("packagecode")[0].ornamentgold);$scope.listpackage=filterfunction.filterarray($scope.listpackage,{productcode:$rootScope.billdata.productcode});$rootScope.billdata.transactiontype=appvariables.get("transactiontype")[0].issue;$rootScope.billdata.goldsmithtransactiontype=appvariables.get("transactiontype")[0].issue;$rootScope.billdata.store=appvariables.get("storetype")[0].godown;$rootScope.billdata.customertype=appvariables.get("customertype")[0].goldsmith;$scope.loadcustomer(appvariables.get("customertype")[0].goldsmith);$scope.showreturns=false;$scope.showissuetable=true;$scope.showreturnstable=false};$scope.initbill=function(){$rootScope.billdata.productcode=appvariables.get("addonproductcode")[0].metal;$scope.loadcustomer(appvariables.get("customertype")[0].wholesale);$scope.listvalueaddition();$scope.item=true;$scope.rate=true;$scope.category=true;$scope.comments=true;$scope.customertype=1;$scope.hidereturn=true;$scope.hidebillsettings=true;$scope.hidestockdetails=true;$scope.hidevadetails=true;$scope.hidestockedit=true;$scope.hidestockmovement=true;$scope.hidestockgrid=true;$scope.hidecategorygrid=true;$rootScope.transactiondetails=[];$rootScope.transactionsummary=[];$rootScope.transactionbilldetails=[];$rootScope.metalbasepurity=appvariables.get("basepuritypercentage");$rootScope.billdata.transactiontype=0};$scope.initbilledit=function(){$rootScope.editbilldata.receiptno=$rootScope.editbillreceiptno;$rootScope.editbilldata.customer=$rootScope.editbillcustomer;$rootScope.editbilldata.customertype=$rootScope.editbillcustomertype;$rootScope.editbilldata.transactiondate=$rootScope.editbilltransactiondate;$scope.listpackage=filterfunction.getpackagenames(appvariables.get("packagecode")[0].ornamentgold);servicesservice.getreceipt($rootScope.editbilldata,function(data){if(data!=undefined){$scope.edittransactionlist=data[0];$scope.transactionitemlist=data[1]}else{logger.logWarning("receipt details not available")}})};$scope.open=function($event,index){$event.preventDefault();$event.stopPropagation();$scope.opened=new Array;return $scope.opened[index]=true};$scope.dateOptions={"year-format":"'yy'","starting-day":1}}]);